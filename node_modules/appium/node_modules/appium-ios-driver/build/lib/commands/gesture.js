'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _utils = require('../utils');

var _logger = require('../logger');

var _logger2 = _interopRequireDefault(_logger);

var commands = {},
    helpers = {},
    extensions = {};
var FLICK_MS = 3000;

commands.nativeTap = function callee$0$0(el) {
  var command;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);
        command = 'au.tapById(\'' + el + '\')';
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.click = function callee$0$0(el) {
  var atomsElement;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        if (!this.isWebContext()) {
          context$1$0.next = 13;
          break;
        }

        if (!(this.opts.nativeWebTap && !this.isRealDevice())) {
          context$1$0.next = 7;
          break;
        }

        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.nativeWebTap(el));

      case 5:
        context$1$0.next = 11;
        break;

      case 7:
        atomsElement = this.useAtomsElement(el);
        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.executeAtom('click', [atomsElement]));

      case 10:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 11:
        context$1$0.next = 19;
        break;

      case 13:
        if (!this.opts.useRobot) {
          context$1$0.next = 17;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 17:
        context$1$0.next = 19;
        return _regeneratorRuntime.awrap(this.nativeTap(el));

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.clickCurrent = function callee$0$0() {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 7;
          break;
        }

        if (!_lodash2['default'].isNull(this.curWebCoords)) {
          context$1$0.next = 3;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownError('Cannot call click() before calling moveTo() to set coords');

      case 3:
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.clickWebCoords());

      case 5:
        context$1$0.next = 11;
        break;

      case 7:
        if (!(this.curCoords === null)) {
          context$1$0.next = 9;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownError("Cannot call click() before calling moveTo() to set coords");

      case 9:
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.clickCoords(this.curCoords));

      case 11:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.clickCoords = function callee$0$0(coords) {
  var opts, command;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.opts.useRobot) {
          context$1$0.next = 4;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 4:
        opts = coords;

        opts.tapCount = 1;
        opts.duration = 0.3;
        opts.touchCount = 1;
        command = 'au.complexTap(' + JSON.stringify(opts) + ')';
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

      case 11:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.mobileRotation = function callee$0$0(x, y, radius, rotation, touchCount, duration, el) {
  var location, options;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 2;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 2:
        el = (0, _utils.unwrapEl)(el);
        location = { x: x, y: y };
        options = { duration: duration, radius: radius, rotation: rotation, touchCount: touchCount };

        if (!el) {
          context$1$0.next = 12;
          break;
        }

        if (!this.isWebContext()) {
          context$1$0.next = 8;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 8:
        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(
        // UIAElement.rotateWithOptions takes only one options param.
        'au.getElement(\'' + el + '\').rotateWithOptions(' + JSON.stringify(options) + ')'));

      case 10:
        context$1$0.next = 14;
        break;

      case 12:
        context$1$0.next = 14;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('target.rotateWithOptions(' + JSON.stringify(location) + ', ' + JSON.stringify(options) + ')'));

      case 14:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.handleTap = function callee$0$0(gesture) {
  var options, cmdBase, rect, offsetX, offsetY, size, opts, cmd;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        options = gesture.options;
        cmdBase = options.element ? 'au.getElement(\'' + options.element + '\')' : 'UIATarget.localTarget().frontMostApp()';
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(cmdBase + '.rect()'));

      case 4:
        rect = context$1$0.sent;
        offsetX = 0.5;
        offsetY = 0.5;
        size = { w: rect.size.width, h: rect.size.height };

        // default options x/y to center, no matter the container
        options.x = options.x || size.w / 2;
        options.y = options.y || size.h / 2;

        offsetX = options.x / size.w;
        offsetY = options.y / size.h;

        opts = {
          tapOffset: {
            x: offsetX,
            y: offsetY
          },
          tapCount: options.count || 1,
          touchCount: 1
        };
        cmd = cmdBase + '.tapWithOptions(' + JSON.stringify(opts) + ')';
        context$1$0.next = 16;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(cmd));

      case 16:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 17:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.isDrag = function (gestures) {
  return gestures.length === 4 && gestures[0].action === 'press' && gestures[1].action === 'wait' && gestures[2].action === 'moveTo' && gestures[3].action === 'release';
};

helpers.isPinchAndZoom = function (gestures) {
  return gestures.length === 3 && gestures[0].action === 'press' && gestures[1].action === 'moveTo' && gestures[2].action === 'release';
};

helpers.getCoordinates = function callee$0$0(gesture) {
  var el, coordinates, command, rect, pos, size, offsetX, offsetY;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = gesture.options.element;
        coordinates = { x: 0, y: 0, areOffsets: false };

        if (!el) {
          context$1$0.next = 16;
          break;
        }

        command = 'au.getElement(\'' + el + '\').rect()';
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

      case 6:
        rect = context$1$0.sent;
        pos = { x: rect.origin.x, y: rect.origin.y };
        size = { w: rect.size.width, h: rect.size.height };
        offsetX = 0;
        offsetY = 0;

        // get the real offsets
        if (gesture.options.x || gesture.options.y) {
          offsetX = gesture.options.x || 0;
          offsetY = gesture.options.y || 0;
        } else {
          offsetX = size.w / 2;
          offsetY = size.h / 2;
        }

        // apply the offsets
        coordinates.x = pos.x + offsetX;
        coordinates.y = pos.y + offsetY;
        context$1$0.next = 19;
        break;

      case 16:
        // moveTo coordinates are passed in as offsets
        coordinates.areOffsets = gesture.action === 'moveTo';
        coordinates.x = gesture.options.x || 0;
        coordinates.y = gesture.options.y || 0;

      case 19:
        return context$1$0.abrupt('return', coordinates);

      case 20:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.applyMoveToOffset = function (firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

helpers.handleDrag = function callee$0$0(gestures) {
  var press, wait, moveTo, pressCoordinates, duration, moveToCoordinates, dragCommand;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        press = gestures[0];
        wait = gestures[1];
        moveTo = gestures[2];
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.getCoordinates(press));

      case 5:
        pressCoordinates = context$1$0.sent;
        duration = parseInt(wait.options.ms, 10) / 1000;
        context$1$0.next = 9;
        return _regeneratorRuntime.awrap(this.getCoordinates(moveTo));

      case 9:
        moveToCoordinates = context$1$0.sent;

        // update moveTo coordinates with offset
        moveToCoordinates = this.applyMoveToOffset(pressCoordinates, moveToCoordinates);

        // build drag command
        dragCommand = 'au.dragApp(' + (pressCoordinates.x + ', ' + pressCoordinates.y + ', ') + (moveToCoordinates.x + ', ' + moveToCoordinates.y + ', ') + (duration + ')');
        context$1$0.next = 14;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(dragCommand));

      case 14:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 15:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.handlePinchAndZoom = function callee$0$0(gestures) {
  var press, moveTo, pressCoordinates, moveToCoordinates, pinchCommand;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        press = gestures[0];
        moveTo = gestures[1];
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.getCoordinates(press));

      case 4:
        pressCoordinates = context$1$0.sent;
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.getCoordinates(moveTo));

      case 7:
        moveToCoordinates = context$1$0.sent;

        // update moveTo coordinates with offset
        moveToCoordinates = this.applyMoveToOffset(pressCoordinates, moveToCoordinates);

        // build pinch command
        pinchCommand = 'au.dragApp(' + (pressCoordinates.x + ', ' + pressCoordinates.y + ', ') + (moveToCoordinates.x + ', ' + moveToCoordinates.y);
        context$1$0.next = 12;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(pinchCommand));

      case 12:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 13:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.performTouch = function callee$0$0(gestures) {
  var touchStateObjects;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 2;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 2:
        if (!(gestures.length === 1 && gestures[0].action === 'tap')) {
          context$1$0.next = 8;
          break;
        }

        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.handleTap(gestures[0]));

      case 5:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 8:
        if (!this.isDrag(gestures)) {
          context$1$0.next = 12;
          break;
        }

        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.handleDrag(gestures));

      case 11:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 12:
        context$1$0.next = 14;
        return _regeneratorRuntime.awrap(this.parseTouch(gestures));

      case 14:
        touchStateObjects = context$1$0.sent;
        context$1$0.next = 17;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('target.touch(' + JSON.stringify(touchStateObjects) + ')'));

      case 17:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.parseTouch = function callee$0$0(gestures) {
  var touchStateObjects, finishParsing, needsPoint, cycleThroughGestures;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        // `release` is automatic in iOS
        if (_lodash2['default'].last(gestures).action === 'release') {
          gestures.pop();
        }

        touchStateObjects = [];

        finishParsing = function finishParsing() {
          var prevPos = null;

          // we need to change the time (which is now an offset)
          // and the position (which may be an offset)
          var time = 0;
          var _iteratorNormalCompletion = true;
          var _didIteratorError = false;
          var _iteratorError = undefined;

          try {
            for (var _iterator = _getIterator(touchStateObjects), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              var state = _step.value;

              if (state.touch[0] === false) {
                // if we have no position (this happens with `wait`) we need the previous one
                state.touch[0] = prevPos;
              } else if (state.touch[0].offset && prevPos) {
                // the current position is an offset
                state.touch[0].x += prevPos.x;
                state.touch[0].y += prevPos.y;
              }
              // prevent wait => press => moveto crash
              if (state.touch[0]) {
                delete state.touch[0].offset;
                prevPos = state.touch[0];
              }

              var timeOffset = state.timeOffset;
              time += timeOffset;
              state.time = time;

              delete state.timeOffset;
            }
          } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion && _iterator['return']) {
                _iterator['return']();
              }
            } finally {
              if (_didIteratorError) {
                throw _iteratorError;
              }
            }
          }
        };

        needsPoint = function needsPoint(action) {
          return _lodash2['default'].includes(['press', 'moveTo', 'tap', 'longPress'], action);
        };

        cycleThroughGestures = function cycleThroughGestures() {
          var gesture, tapPoint, el, command, rect, pos, size, touchStateObject, offset;
          return _regeneratorRuntime.async(function cycleThroughGestures$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                gesture = gestures.shift();

                if (!(typeof gesture === "undefined")) {
                  context$2$0.next = 3;
                  break;
                }

                return context$2$0.abrupt('return', finishParsing());

              case 3:
                tapPoint = false;

                if (!needsPoint(gesture.action)) {
                  context$2$0.next = 27;
                  break;
                }

                el = gesture.options.element;

                if (!el) {
                  context$2$0.next = 20;
                  break;
                }

                command = 'au.getElement(\'' + el + '\').rect()';
                context$2$0.next = 10;
                return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

              case 10:
                rect = context$2$0.sent;
                pos = { x: rect.origin.x, y: rect.origin.y };
                size = { w: rect.size.width, h: rect.size.height };

                if (gesture.options.x || gesture.options.y) {
                  tapPoint = {
                    offset: false,
                    x: pos.x + (gesture.options.x || 0),
                    y: pos.y + (gesture.options.y || 0)
                  };
                } else {
                  tapPoint = {
                    offset: false,
                    x: pos.x + size.w / 2,
                    y: pos.y + size.h / 2
                  };
                }

                touchStateObject = {
                  timeOffset: 0.2,
                  touch: [tapPoint]
                };

                touchStateObjects.push(touchStateObject);
                context$2$0.next = 18;
                return _regeneratorRuntime.awrap(cycleThroughGestures());

              case 18:
                context$2$0.next = 25;
                break;

              case 20:
                // iOS expects absolute coordinates, so we need to save these as offsets
                // and then translate when everything is done
                tapPoint = {
                  offset: true,
                  x: gesture.options.x || 0,
                  y: gesture.options.y || 0
                };
                touchStateObject = {
                  timeOffset: 0.2,
                  touch: [tapPoint]
                };

                touchStateObjects.push(touchStateObject);
                context$2$0.next = 25;
                return _regeneratorRuntime.awrap(cycleThroughGestures());

              case 25:
                context$2$0.next = 34;
                break;

              case 27:
                // in this case we need the previous entry's tap point
                tapPoint = false; // temporary marker
                offset = 0.2;

                if (gesture.action === 'wait') {
                  if (typeof gesture.options.ms !== 'undefined' || gesture.options.ms !== null) {
                    offset = parseInt(gesture.options.ms, 10) / 1000;
                  }
                }
                touchStateObject = {
                  timeOffset: offset,
                  touch: [tapPoint]
                };

                touchStateObjects.push(touchStateObject);
                context$2$0.next = 34;
                return _regeneratorRuntime.awrap(cycleThroughGestures());

              case 34:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        };

        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(cycleThroughGestures());

      case 7:
        return context$1$0.abrupt('return', touchStateObjects);

      case 8:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

var mergeStates = function mergeStates(states) {
  var getSlice = function getSlice(states, index) {
    var array = [];
    for (var i = 0; i < states.length; i++) {
      array.push(states[i][index]);
    }

    return array;
  };

  var timeSequence = function timeSequence(states) {
    var seq = [];
    _lodash2['default'].each(states, function (state) {
      var times = _lodash2['default'].map(state, "time");
      seq = _lodash2['default'].union(seq, times);
    });

    return seq.sort();
  };

  // for now we will just assume that the times line up
  var merged = [];
  _lodash2['default'].each(timeSequence(states), function (time, index) {
    var slice = getSlice(states, index);
    var obj = {
      time: time,
      touch: []
    };
    _lodash2['default'].each(slice, function (action) {
      obj.touch.push(action.touch[0]);
    });
    merged.push(obj);
  });
  return merged;
};

commands.performMultiAction = function callee$0$0(actions, el) {
  var states, cycleThroughActions;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    var _this2 = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 2;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 2:

        el = (0, _utils.unwrapEl)(el);
        // TODO: why elementId is not used
        states = [];

        cycleThroughActions = function cycleThroughActions() {
          var action, mergedStates, val;
          return _regeneratorRuntime.async(function cycleThroughActions$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                action = actions.shift();

                if (!(typeof action === "undefined")) {
                  context$2$0.next = 12;
                  break;
                }

                mergedStates = mergeStates(states);

                if (!this.isPinchAndZoom(mergedStates)) {
                  context$2$0.next = 9;
                  break;
                }

                context$2$0.next = 6;
                return _regeneratorRuntime.awrap(this.handlePinchAndZoom(mergedStates));

              case 6:
                return context$2$0.abrupt('return');

              case 9:
                context$2$0.next = 11;
                return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('target.touch(' + JSON.stringify(mergedStates) + ')'));

              case 11:
                return context$2$0.abrupt('return');

              case 12:
                context$2$0.next = 14;
                return _regeneratorRuntime.awrap(this.parseTouch(action));

              case 14:
                val = context$2$0.sent;

                states.push(val);
                context$2$0.next = 18;
                return _regeneratorRuntime.awrap(cycleThroughActions());

              case 18:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this2);
        };

        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(cycleThroughActions());

      case 7:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.mobileScroll = function callee$0$0() {
  var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
  var direction, el, command;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        direction = opts.direction;
        el = opts.element;

        el = (0, _utils.unwrapEl)(el);

        if (!this.isWebContext()) {
          context$1$0.next = 7;
          break;
        }

        throw new _appiumBaseDriver.errors.NotYetImplementedError();

      case 7:
        direction = _lodash2['default'].capitalize(direction);
        command = undefined;

        if (_lodash2['default'].isNull(el) || _lodash2['default'].isUndefined(el)) {
          // By default, scroll the first scrollview.
          command = 'au.scrollFirstView(\'' + direction + '\')';
        } else {
          // if element is defined, call scrollLeft, scrollRight, scrollUp, and scrollDown on the element.
          command = 'au.getElement(\'' + el + '\').scroll' + direction + '()';
        }
        context$1$0.prev = 10;
        context$1$0.next = 13;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

      case 13:
        context$1$0.next = 20;
        break;

      case 15:
        context$1$0.prev = 15;
        context$1$0.t0 = context$1$0['catch'](10);

        if (_lodash2['default'].includes(context$1$0.t0.message, 'kAXErrorFailure')) {
          context$1$0.next = 19;
          break;
        }

        throw context$1$0.t0;

      case 19:
        // eslint-disable-line curly

        _logger2['default'].warn('Received kAXErrorFailure, generally indicating an attempt ' + 'to scroll past the end of the view. Continuing.');

      case 20:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[10, 15]]);
};

commands.flick = function callee$0$0(el, xspeed, yspeed, xoffset, yoffset, speed) {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        if (!_lodash2['default'].every([el, xoffset, yoffset, speed], function (p) {
          return !_lodash2['default'].isNull(p) && !_lodash2['default'].isUndefined(p);
        })) {
          context$1$0.next = 6;
          break;
        }

        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.flickElement(el, xoffset, yoffset, speed));

      case 4:
        context$1$0.next = 12;
        break;

      case 6:
        if (!_lodash2['default'].every([xspeed, yspeed], function (p) {
          return !_lodash2['default'].isNull(p) && !_lodash2['default'].isUndefined(p);
        })) {
          context$1$0.next = 11;
          break;
        }

        context$1$0.next = 9;
        return _regeneratorRuntime.awrap(this.xySpeedFlick(xspeed, yspeed));

      case 9:
        context$1$0.next = 12;
        break;

      case 11:
        throw new _appiumBaseDriver.errors.UnknownError('Bad flick parameters, pass either (xspeed, yspeed) or (element, xoffset, yoffset, speed)!');

      case 12:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.xySpeedFlick = function callee$0$0(xSpeed, ySpeed) {
  var command;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        command = 'au.touchFlickFromSpeed(' + xSpeed + ',' + ySpeed + ')';
        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(_bluebird2['default'].all([this.uiAutoClient.sendCommand(command), _bluebird2['default'].delay(FLICK_MS)]));

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.flickElement = function callee$0$0(el, xoffset, yoffset, speed) {
  var command;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);
        command = "";

        if (!this.isWebContext()) {
          context$1$0.next = 7;
          break;
        }

        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.webFlickElement(el, xoffset, yoffset));

      case 5:
        context$1$0.next = 10;
        break;

      case 7:
        command = 'au.getElement(\'' + el + '\').touchFlick(' + xoffset + ',' + yoffset + ',' + speed + ')';
        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(_bluebird2['default'].all([this.uiAutoClient.sendCommand(command), _bluebird2['default'].delay(FLICK_MS)]));

      case 10:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

// TODO: maybe rename this in mjsonwp
commands.mobileShake = function callee$0$0() {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand("au.shake()"));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.moveTo = function callee$0$0(el) {
  var xoffset = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];
  var yoffset = arguments.length <= 2 || arguments[2] === undefined ? 0 : arguments[2];

  var _ref, x, y, coords, atomsElement, relCoords, elPos;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = (0, _utils.unwrapEl)(el);

        if (!this.isWebContext()) {
          context$1$0.next = 15;
          break;
        }

        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.getLocation(el));

      case 4:
        _ref = context$1$0.sent;
        x = _ref.x;
        y = _ref.y;
        coords = {
          x: x + xoffset,
          y: y + yoffset
        };

        this.curWebCoords = coords;
        atomsElement = this.useAtomsElement(el);
        relCoords = { x: xoffset, y: yoffset };
        context$1$0.next = 13;
        return _regeneratorRuntime.awrap(this.executeAtom('move_mouse', [atomsElement, relCoords]));

      case 13:
        context$1$0.next = 25;
        break;

      case 15:
        if (!(_lodash2['default'].isNull(el) || _lodash2['default'].isUndefined(el))) {
          context$1$0.next = 21;
          break;
        }

        if (this.curCoords) {
          context$1$0.next = 18;
          break;
        }

        throw new _appiumBaseDriver.errors.UnknownException('Current cursor position unknown, please use moveTo with an element the first time.');

      case 18:
        this.curCoords = {
          x: this.curCoords.x + xoffset,
          y: this.curCoords.y + yoffset
        };
        context$1$0.next = 25;
        break;

      case 21:
        context$1$0.next = 23;
        return _regeneratorRuntime.awrap(this.getLocation(el));

      case 23:
        elPos = context$1$0.sent;

        this.curCoords = {
          x: elPos.x + xoffset,
          y: elPos.y + yoffset
        };

      case 25:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

_Object$assign(extensions, commands, helpers);
exports.commands = commands;
exports.helpers = helpers;
exports['default'] = extensions;

// atoms-based clicks don't always work in safari 7

/* TODO */ /*button*/
/* TODO */
// not implemented yet in the web

// start by getting the size and position of the element we are tapping

// default to center

// defaults

// figure out the element coordinates.

// defaults

// get gestures

// get drag data

// execute drag command

// get gestures

// get pinch data
// press, longPress, moveTo and tap all need a position

// not implemented yet in web

// speed is not used because underlying UIATarget.flickFromTo doesn't support it
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O2dDQUF1QixvQkFBb0I7O3NCQUM3QixRQUFROzs7O3dCQUNSLFVBQVU7Ozs7cUJBQ0MsVUFBVTs7c0JBQ2hCLFdBQVc7Ozs7QUFHOUIsSUFBSSxRQUFRLEdBQUcsRUFBRTtJQUFFLE9BQU8sR0FBRyxFQUFFO0lBQUUsVUFBVSxHQUFHLEVBQUUsQ0FBQztBQUNqRCxJQUFNLFFBQVEsR0FBRyxJQUFJLENBQUM7O0FBRXRCLFFBQVEsQ0FBQyxTQUFTLEdBQUcsb0JBQWdCLEVBQUU7TUFFakMsT0FBTzs7OztBQURYLFVBQUUsR0FBRyxxQkFBUyxFQUFFLENBQUMsQ0FBQztBQUNkLGVBQU8scUJBQWtCLEVBQUU7O3lDQUN6QixJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUM7Ozs7Ozs7Q0FDN0MsQ0FBQzs7QUFFRixRQUFRLENBQUMsS0FBSyxHQUFHLG9CQUFnQixFQUFFO01BT3pCLFlBQVk7Ozs7QUFOcEIsVUFBRSxHQUFHLHFCQUFTLEVBQUUsQ0FBQyxDQUFDOzthQUNkLElBQUksQ0FBQyxZQUFZLEVBQUU7Ozs7O2NBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBOzs7Ozs7eUNBRTFDLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDOzs7Ozs7O0FBRXZCLG9CQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7O3lDQUM5QixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDOzs7Ozs7Ozs7O2FBR3BELElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUTs7Ozs7Y0FDSixJQUFJLHlCQUFPLHNCQUFzQixFQUFFOzs7O3lDQUU3QyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQzs7Ozs7OztDQUc3QixD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RUFBRSxDQUFDLEdBQUcsT0FBTztTQUNmOztBQUNELFlBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDO0FBQ3ZCLG9CQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUM7QUFDdkMsaUJBQVMsR0FBRyxFQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBQzs7eUNBQ2xDLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDOzs7Ozs7O2NBRTNELG9CQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsSUFBSSxvQkFBRSxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUE7Ozs7O1lBQzlCLElBQUksQ0FBQyxTQUFTOzs7OztjQUNYLElBQUkseUJBQU8sZ0JBQWdCLENBQy9CLG9GQUFvRixDQUFDOzs7QUFFekYsWUFBSSxDQUFDLFNBQVMsR0FBRztBQUNmLFdBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxPQUFPO0FBQzdCLFdBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxPQUFPO1NBQzlCLENBQUM7Ozs7Ozt5Q0FFZ0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7OztBQUFsQyxhQUFLOztBQUNULFlBQUksQ0FBQyxTQUFTLEdBQUc7QUFDZixXQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsR0FBRyxPQUFPO0FBQ3BCLFdBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxHQUFHLE9BQU87U0FDckIsQ0FBQzs7Ozs7OztDQUdQLENBQUM7O0FBRUYsZUFBYyxVQUFVLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3BDLFFBQVEsR0FBUixRQUFRO1FBQUUsT0FBTyxHQUFQLE9BQU87cUJBQ1gsVUFBVSIsImZpbGUiOiJsaWIvY29tbWFuZHMvZ2VzdHVyZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS1iYXNlLWRyaXZlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgdW53cmFwRWwgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4uL2xvZ2dlcic7XG5cblxubGV0IGNvbW1hbmRzID0ge30sIGhlbHBlcnMgPSB7fSwgZXh0ZW5zaW9ucyA9IHt9O1xuY29uc3QgRkxJQ0tfTVMgPSAzMDAwO1xuXG5jb21tYW5kcy5uYXRpdmVUYXAgPSBhc3luYyBmdW5jdGlvbiAoZWwpIHtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGxldCBjb21tYW5kID0gYGF1LnRhcEJ5SWQoJyR7ZWx9JylgO1xuICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbn07XG5cbmNvbW1hbmRzLmNsaWNrID0gYXN5bmMgZnVuY3Rpb24gKGVsKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGlmICh0aGlzLm9wdHMubmF0aXZlV2ViVGFwICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAvLyBhdG9tcy1iYXNlZCBjbGlja3MgZG9uJ3QgYWx3YXlzIHdvcmsgaW4gc2FmYXJpIDdcbiAgICAgIGF3YWl0IHRoaXMubmF0aXZlV2ViVGFwKGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGF0b21zRWxlbWVudCA9IHRoaXMudXNlQXRvbXNFbGVtZW50KGVsKTtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKHRoaXMub3B0cy51c2VSb2JvdCkge1xuICAgICAgLyogVE9ETyAqL3Rocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLm5hdGl2ZVRhcChlbCk7XG4gICAgfVxuICB9XG59O1xuXG5jb21tYW5kcy5jbGlja0N1cnJlbnQgPSBhc3luYyBmdW5jdGlvbiAoLypidXR0b24qLykge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGlmIChfLmlzTnVsbCh0aGlzLmN1cldlYkNvb3JkcykpIHtcbiAgICAgIHRocm93IG5ldyBlcnJvcnMuVW5rbm93bkVycm9yKCdDYW5ub3QgY2FsbCBjbGljaygpIGJlZm9yZSBjYWxsaW5nIG1vdmVUbygpIHRvIHNldCBjb29yZHMnKTtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5jbGlja1dlYkNvb3JkcygpO1xuICB9IGVsc2Uge1xuICAgIGlmICh0aGlzLmN1ckNvb3JkcyA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoXCJDYW5ub3QgY2FsbCBjbGljaygpIGJlZm9yZSBjYWxsaW5nIG1vdmVUbygpIHRvIHNldCBjb29yZHNcIik7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMuY2xpY2tDb29yZHModGhpcy5jdXJDb29yZHMpO1xuICB9XG59O1xuXG5oZWxwZXJzLmNsaWNrQ29vcmRzID0gYXN5bmMgZnVuY3Rpb24gKGNvb3Jkcykge1xuICBpZiAodGhpcy5vcHRzLnVzZVJvYm90KSB7XG4gICAgLyogVE9ETyAqL3Rocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9IGVsc2Uge1xuICAgIGxldCBvcHRzID0gY29vcmRzO1xuICAgIG9wdHMudGFwQ291bnQgPSAxO1xuICAgIG9wdHMuZHVyYXRpb24gPSAwLjM7XG4gICAgb3B0cy50b3VjaENvdW50ID0gMTtcbiAgICBsZXQgY29tbWFuZCA9IGBhdS5jb21wbGV4VGFwKCR7SlNPTi5zdHJpbmdpZnkob3B0cyl9KWA7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY29tbWFuZCk7XG4gIH1cbn07XG5cbmNvbW1hbmRzLm1vYmlsZVJvdGF0aW9uID0gYXN5bmMgZnVuY3Rpb24gKHgsIHksIHJhZGl1cywgcm90YXRpb24sIHRvdWNoQ291bnQsIGR1cmF0aW9uLCBlbCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcigpO1xuICB9XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICBsZXQgbG9jYXRpb24gPSB7eCwgeX07XG4gIGxldCBvcHRpb25zID0ge2R1cmF0aW9uLCByYWRpdXMsIHJvdGF0aW9uLCB0b3VjaENvdW50fTtcbiAgaWYgKGVsKSB7XG4gICAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAgIC8vIG5vdCBpbXBsZW1lbnRlZCB5ZXQgaW4gdGhlIHdlYlxuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RZZXRJbXBsZW1lbnRlZEVycm9yKCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKFxuICAgICAgLy8gVUlBRWxlbWVudC5yb3RhdGVXaXRoT3B0aW9ucyB0YWtlcyBvbmx5IG9uZSBvcHRpb25zIHBhcmFtLlxuICAgICAgYGF1LmdldEVsZW1lbnQoJyR7ZWx9Jykucm90YXRlV2l0aE9wdGlvbnMoJHtKU09OLnN0cmluZ2lmeShvcHRpb25zKX0pYCk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoXG4gICAgICBgdGFyZ2V0LnJvdGF0ZVdpdGhPcHRpb25zKCR7SlNPTi5zdHJpbmdpZnkobG9jYXRpb24pfSwgJHtKU09OLnN0cmluZ2lmeShvcHRpb25zKX0pYCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuaGFuZGxlVGFwID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmUpIHtcbiAgbGV0IG9wdGlvbnMgPSBnZXN0dXJlLm9wdGlvbnM7XG4gIGxldCBjbWRCYXNlID0gb3B0aW9ucy5lbGVtZW50ID8gYGF1LmdldEVsZW1lbnQoJyR7b3B0aW9ucy5lbGVtZW50fScpYCA6XG4gICAgJ1VJQVRhcmdldC5sb2NhbFRhcmdldCgpLmZyb250TW9zdEFwcCgpJztcblxuICAvLyBzdGFydCBieSBnZXR0aW5nIHRoZSBzaXplIGFuZCBwb3NpdGlvbiBvZiB0aGUgZWxlbWVudCB3ZSBhcmUgdGFwcGluZ1xuICBsZXQgcmVjdCA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGAke2NtZEJhc2V9LnJlY3QoKWApO1xuXG4gIC8vIGRlZmF1bHQgdG8gY2VudGVyXG4gIGxldCBvZmZzZXRYID0gMC41O1xuICBsZXQgb2Zmc2V0WSA9IDAuNTtcblxuICBsZXQgc2l6ZSA9IHt3OiByZWN0LnNpemUud2lkdGgsIGg6IHJlY3Quc2l6ZS5oZWlnaHR9O1xuXG4gIC8vIGRlZmF1bHQgb3B0aW9ucyB4L3kgdG8gY2VudGVyLCBubyBtYXR0ZXIgdGhlIGNvbnRhaW5lclxuICBvcHRpb25zLnggPSAob3B0aW9ucy54IHx8IChzaXplLncgLyAyKSk7XG4gIG9wdGlvbnMueSA9IChvcHRpb25zLnkgfHwgKHNpemUuaCAvIDIpKTtcblxuICBvZmZzZXRYID0gb3B0aW9ucy54IC8gc2l6ZS53O1xuICBvZmZzZXRZID0gb3B0aW9ucy55IC8gc2l6ZS5oO1xuXG4gIGxldCBvcHRzID0ge1xuICAgIHRhcE9mZnNldDoge1xuICAgICAgeDogb2Zmc2V0WCxcbiAgICAgIHk6IG9mZnNldFlcbiAgICB9LFxuICAgIHRhcENvdW50OiBvcHRpb25zLmNvdW50IHx8IDEsXG4gICAgdG91Y2hDb3VudDogMVxuICB9O1xuICBsZXQgY21kID0gYCR7Y21kQmFzZX0udGFwV2l0aE9wdGlvbnMoJHtKU09OLnN0cmluZ2lmeShvcHRzKX0pYDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNtZCk7XG59O1xuXG5oZWxwZXJzLmlzRHJhZyA9IGZ1bmN0aW9uIChnZXN0dXJlcykge1xuICByZXR1cm4gKFxuICAgIGdlc3R1cmVzLmxlbmd0aCA9PT0gNCAmJlxuICAgIGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3ByZXNzJyAmJlxuICAgIGdlc3R1cmVzWzFdLmFjdGlvbiA9PT0gJ3dhaXQnICYmXG4gICAgZ2VzdHVyZXNbMl0uYWN0aW9uID09PSAnbW92ZVRvJyAmJlxuICAgIGdlc3R1cmVzWzNdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnXG4gICk7XG59O1xuXG5oZWxwZXJzLmlzUGluY2hBbmRab29tID0gZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG4gIHJldHVybiAoXG4gICAgZ2VzdHVyZXMubGVuZ3RoID09PSAzICYmXG4gICAgZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAncHJlc3MnICYmXG4gICAgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAnbW92ZVRvJyAmJlxuICAgIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnXG4gICk7XG59O1xuXG5oZWxwZXJzLmdldENvb3JkaW5hdGVzID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmUpIHtcbiAgbGV0IGVsID0gZ2VzdHVyZS5vcHRpb25zLmVsZW1lbnQ7XG5cbiAgLy8gZGVmYXVsdHNcbiAgbGV0IGNvb3JkaW5hdGVzID0ge3g6IDAsIHk6IDAsIGFyZU9mZnNldHM6IGZhbHNlfTtcblxuICAvLyBmaWd1cmUgb3V0IHRoZSBlbGVtZW50IGNvb3JkaW5hdGVzLlxuICBpZiAoZWwpIHtcbiAgICBsZXQgY29tbWFuZCA9IGBhdS5nZXRFbGVtZW50KCcke2VsfScpLnJlY3QoKWA7XG4gICAgbGV0IHJlY3QgPSBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgICBsZXQgcG9zID0ge3g6IHJlY3Qub3JpZ2luLngsIHk6IHJlY3Qub3JpZ2luLnl9O1xuICAgIGxldCBzaXplID0ge3c6IHJlY3Quc2l6ZS53aWR0aCwgaDogcmVjdC5zaXplLmhlaWdodH07XG5cbiAgICAvLyBkZWZhdWx0c1xuICAgIGxldCBvZmZzZXRYID0gMDtcbiAgICBsZXQgb2Zmc2V0WSA9IDA7XG5cbiAgICAvLyBnZXQgdGhlIHJlYWwgb2Zmc2V0c1xuICAgIGlmIChnZXN0dXJlLm9wdGlvbnMueCB8fCBnZXN0dXJlLm9wdGlvbnMueSkge1xuICAgICAgb2Zmc2V0WCA9IChnZXN0dXJlLm9wdGlvbnMueCB8fCAwKTtcbiAgICAgIG9mZnNldFkgPSAoZ2VzdHVyZS5vcHRpb25zLnkgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9mZnNldFggPSAoc2l6ZS53IC8gMik7XG4gICAgICBvZmZzZXRZID0gKHNpemUuaCAvIDIpO1xuICAgIH1cblxuICAgIC8vIGFwcGx5IHRoZSBvZmZzZXRzXG4gICAgY29vcmRpbmF0ZXMueCA9IHBvcy54ICsgb2Zmc2V0WDtcbiAgICBjb29yZGluYXRlcy55ID0gcG9zLnkgKyBvZmZzZXRZO1xuICB9IGVsc2Uge1xuICAgIC8vIG1vdmVUbyBjb29yZGluYXRlcyBhcmUgcGFzc2VkIGluIGFzIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy5hcmVPZmZzZXRzID0gKGdlc3R1cmUuYWN0aW9uID09PSAnbW92ZVRvJyk7XG4gICAgY29vcmRpbmF0ZXMueCA9IChnZXN0dXJlLm9wdGlvbnMueCB8fCAwKTtcbiAgICBjb29yZGluYXRlcy55ID0gKGdlc3R1cmUub3B0aW9ucy55IHx8IDApO1xuICB9XG4gIHJldHVybiBjb29yZGluYXRlcztcbn07XG5cbmhlbHBlcnMuYXBwbHlNb3ZlVG9PZmZzZXQgPSBmdW5jdGlvbiAoZmlyc3RDb29yZGluYXRlcywgc2Vjb25kQ29vcmRpbmF0ZXMpIHtcbiAgaWYgKHNlY29uZENvb3JkaW5hdGVzLmFyZU9mZnNldHMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogZmlyc3RDb29yZGluYXRlcy54ICsgc2Vjb25kQ29vcmRpbmF0ZXMueCxcbiAgICAgIHk6IGZpcnN0Q29vcmRpbmF0ZXMueSArIHNlY29uZENvb3JkaW5hdGVzLnksXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc2Vjb25kQ29vcmRpbmF0ZXM7XG4gIH1cbn07XG5cbmhlbHBlcnMuaGFuZGxlRHJhZyA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcykge1xuICAvLyBnZXQgZ2VzdHVyZXNcbiAgbGV0IHByZXNzID0gZ2VzdHVyZXNbMF07XG4gIGxldCB3YWl0ID0gZ2VzdHVyZXNbMV07XG4gIGxldCBtb3ZlVG8gPSBnZXN0dXJlc1syXTtcblxuICAvLyBnZXQgZHJhZyBkYXRhXG4gIGxldCBwcmVzc0Nvb3JkaW5hdGVzID0gYXdhaXQgdGhpcy5nZXRDb29yZGluYXRlcyhwcmVzcyk7XG4gIGxldCBkdXJhdGlvbiA9IChwYXJzZUludCh3YWl0Lm9wdGlvbnMubXMsIDEwKSAvIDEwMDApO1xuICBsZXQgbW92ZVRvQ29vcmRpbmF0ZXMgPSBhd2FpdCB0aGlzLmdldENvb3JkaW5hdGVzKG1vdmVUbyk7XG5cbiAgLy8gdXBkYXRlIG1vdmVUbyBjb29yZGluYXRlcyB3aXRoIG9mZnNldFxuICBtb3ZlVG9Db29yZGluYXRlcyA9IHRoaXMuYXBwbHlNb3ZlVG9PZmZzZXQocHJlc3NDb29yZGluYXRlcywgbW92ZVRvQ29vcmRpbmF0ZXMpO1xuXG4gIC8vIGJ1aWxkIGRyYWcgY29tbWFuZFxuICBsZXQgZHJhZ0NvbW1hbmQgPSAoYGF1LmRyYWdBcHAoYCArXG4gICAgYCR7cHJlc3NDb29yZGluYXRlcy54fSwgJHtwcmVzc0Nvb3JkaW5hdGVzLnl9LCBgICtcbiAgICBgJHttb3ZlVG9Db29yZGluYXRlcy54fSwgJHttb3ZlVG9Db29yZGluYXRlcy55fSwgYCArXG4gICAgYCR7ZHVyYXRpb259KWApO1xuXG4gIC8vIGV4ZWN1dGUgZHJhZyBjb21tYW5kXG4gIHJldHVybiBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChkcmFnQ29tbWFuZCk7XG59O1xuXG5oZWxwZXJzLmhhbmRsZVBpbmNoQW5kWm9vbSA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcykge1xuICAvLyBnZXQgZ2VzdHVyZXNcbiAgbGV0IHByZXNzID0gZ2VzdHVyZXNbMF07XG4gIGxldCBtb3ZlVG8gPSBnZXN0dXJlc1sxXTtcblxuICAvLyBnZXQgcGluY2ggZGF0YVxuICBsZXQgcHJlc3NDb29yZGluYXRlcyA9IGF3YWl0IHRoaXMuZ2V0Q29vcmRpbmF0ZXMocHJlc3MpO1xuICBsZXQgbW92ZVRvQ29vcmRpbmF0ZXMgPSBhd2FpdCB0aGlzLmdldENvb3JkaW5hdGVzKG1vdmVUbyk7XG5cbiAgLy8gdXBkYXRlIG1vdmVUbyBjb29yZGluYXRlcyB3aXRoIG9mZnNldFxuICBtb3ZlVG9Db29yZGluYXRlcyA9IHRoaXMuYXBwbHlNb3ZlVG9PZmZzZXQocHJlc3NDb29yZGluYXRlcywgbW92ZVRvQ29vcmRpbmF0ZXMpO1xuXG4gIC8vIGJ1aWxkIHBpbmNoIGNvbW1hbmRcbiAgbGV0IHBpbmNoQ29tbWFuZCA9IChgYXUuZHJhZ0FwcChgICtcbiAgICBgJHtwcmVzc0Nvb3JkaW5hdGVzLnh9LCAke3ByZXNzQ29vcmRpbmF0ZXMueX0sIGAgK1xuICAgIGAke21vdmVUb0Nvb3JkaW5hdGVzLnh9LCAke21vdmVUb0Nvb3JkaW5hdGVzLnl9YCk7XG5cbiAgcmV0dXJuIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKHBpbmNoQ29tbWFuZCk7XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtVG91Y2ggPSBhc3luYyBmdW5jdGlvbiAoZ2VzdHVyZXMpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDEgJiYgZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAndGFwJykge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmhhbmRsZVRhcChnZXN0dXJlc1swXSk7XG4gIH0gZWxzZSBpZiAodGhpcy5pc0RyYWcoZ2VzdHVyZXMpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaGFuZGxlRHJhZyhnZXN0dXJlcyk7XG4gIH1cbiAgbGV0IHRvdWNoU3RhdGVPYmplY3RzID0gYXdhaXQgdGhpcy5wYXJzZVRvdWNoKGdlc3R1cmVzKTtcbiAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoYHRhcmdldC50b3VjaCgke0pTT04uc3RyaW5naWZ5KHRvdWNoU3RhdGVPYmplY3RzKX0pYCk7XG59O1xuXG5jb21tYW5kcy5wYXJzZVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG4gIC8vIGByZWxlYXNlYCBpcyBhdXRvbWF0aWMgaW4gaU9TXG4gIGlmIChfLmxhc3QoZ2VzdHVyZXMpLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG4gICAgZ2VzdHVyZXMucG9wKCk7XG4gIH1cblxuICBsZXQgdG91Y2hTdGF0ZU9iamVjdHMgPSBbXTtcbiAgbGV0IGZpbmlzaFBhcnNpbmcgPSAoKSA9PiB7XG4gICAgbGV0IHByZXZQb3MgPSBudWxsO1xuXG4gICAgLy8gd2UgbmVlZCB0byBjaGFuZ2UgdGhlIHRpbWUgKHdoaWNoIGlzIG5vdyBhbiBvZmZzZXQpXG4gICAgLy8gYW5kIHRoZSBwb3NpdGlvbiAod2hpY2ggbWF5IGJlIGFuIG9mZnNldClcbiAgICBsZXQgdGltZSA9IDA7XG4gICAgZm9yIChsZXQgc3RhdGUgb2YgdG91Y2hTdGF0ZU9iamVjdHMpIHtcbiAgICAgIGlmIChzdGF0ZS50b3VjaFswXSA9PT0gZmFsc2UpIHtcbiAgICAgICAgLy8gaWYgd2UgaGF2ZSBubyBwb3NpdGlvbiAodGhpcyBoYXBwZW5zIHdpdGggYHdhaXRgKSB3ZSBuZWVkIHRoZSBwcmV2aW91cyBvbmVcbiAgICAgICAgc3RhdGUudG91Y2hbMF0gPSBwcmV2UG9zO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZS50b3VjaFswXS5vZmZzZXQgJiYgcHJldlBvcykge1xuICAgICAgICAvLyB0aGUgY3VycmVudCBwb3NpdGlvbiBpcyBhbiBvZmZzZXRcbiAgICAgICAgc3RhdGUudG91Y2hbMF0ueCArPSBwcmV2UG9zLng7XG4gICAgICAgIHN0YXRlLnRvdWNoWzBdLnkgKz0gcHJldlBvcy55O1xuICAgICAgfVxuICAgICAgLy8gcHJldmVudCB3YWl0ID0+IHByZXNzID0+IG1vdmV0byBjcmFzaFxuICAgICAgaWYgKHN0YXRlLnRvdWNoWzBdKSB7XG4gICAgICAgIGRlbGV0ZSBzdGF0ZS50b3VjaFswXS5vZmZzZXQ7XG4gICAgICAgIHByZXZQb3MgPSBzdGF0ZS50b3VjaFswXTtcbiAgICAgIH1cblxuXG4gICAgICBsZXQgdGltZU9mZnNldCA9IHN0YXRlLnRpbWVPZmZzZXQ7XG4gICAgICB0aW1lICs9IHRpbWVPZmZzZXQ7XG4gICAgICBzdGF0ZS50aW1lID0gdGltZTtcblxuICAgICAgZGVsZXRlIHN0YXRlLnRpbWVPZmZzZXQ7XG4gICAgfVxuICB9O1xuXG4gIGxldCBuZWVkc1BvaW50ID0gKGFjdGlvbikgPT4ge1xuICAgIHJldHVybiBfLmluY2x1ZGVzKFsncHJlc3MnLCAnbW92ZVRvJywgJ3RhcCcsICdsb25nUHJlc3MnXSwgYWN0aW9uKTtcbiAgfTtcblxuICBsZXQgY3ljbGVUaHJvdWdoR2VzdHVyZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGdlc3R1cmUgPSBnZXN0dXJlcy5zaGlmdCgpO1xuICAgIGlmICh0eXBlb2YgZ2VzdHVyZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgcmV0dXJuIGZpbmlzaFBhcnNpbmcoKTtcbiAgICB9XG4gICAgbGV0IHRhcFBvaW50ID0gZmFsc2U7XG5cbiAgICBpZiAobmVlZHNQb2ludChnZXN0dXJlLmFjdGlvbikpIHsgLy8gcHJlc3MsIGxvbmdQcmVzcywgbW92ZVRvIGFuZCB0YXAgYWxsIG5lZWQgYSBwb3NpdGlvblxuICAgICAgbGV0IGVsID0gZ2VzdHVyZS5vcHRpb25zLmVsZW1lbnQ7XG4gICAgICBpZiAoZWwpIHtcbiAgICAgICAgbGV0IGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5yZWN0KClgO1xuICAgICAgICBsZXQgcmVjdCA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICBsZXQgcG9zID0ge3g6IHJlY3Qub3JpZ2luLngsIHk6IHJlY3Qub3JpZ2luLnl9O1xuICAgICAgICBsZXQgc2l6ZSA9IHt3OiByZWN0LnNpemUud2lkdGgsIGg6IHJlY3Quc2l6ZS5oZWlnaHR9O1xuXG4gICAgICAgIGlmIChnZXN0dXJlLm9wdGlvbnMueCB8fCBnZXN0dXJlLm9wdGlvbnMueSkge1xuICAgICAgICAgIHRhcFBvaW50ID0ge1xuICAgICAgICAgICAgb2Zmc2V0OiBmYWxzZSxcbiAgICAgICAgICAgIHg6IHBvcy54ICsgKGdlc3R1cmUub3B0aW9ucy54IHx8IDApLFxuICAgICAgICAgICAgeTogcG9zLnkgKyAoZ2VzdHVyZS5vcHRpb25zLnkgfHwgMClcbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcFBvaW50ID0ge1xuICAgICAgICAgICAgb2Zmc2V0OiBmYWxzZSxcbiAgICAgICAgICAgIHg6IHBvcy54ICsgKHNpemUudyAvIDIpLFxuICAgICAgICAgICAgeTogcG9zLnkgKyAoc2l6ZS5oIC8gMilcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHRvdWNoU3RhdGVPYmplY3QgPSB7XG4gICAgICAgICAgdGltZU9mZnNldDogMC4yLFxuICAgICAgICAgIHRvdWNoOiBbXG4gICAgICAgICAgICB0YXBQb2ludFxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgICAgdG91Y2hTdGF0ZU9iamVjdHMucHVzaCh0b3VjaFN0YXRlT2JqZWN0KTtcbiAgICAgICAgYXdhaXQgY3ljbGVUaHJvdWdoR2VzdHVyZXMoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGlPUyBleHBlY3RzIGFic29sdXRlIGNvb3JkaW5hdGVzLCBzbyB3ZSBuZWVkIHRvIHNhdmUgdGhlc2UgYXMgb2Zmc2V0c1xuICAgICAgICAvLyBhbmQgdGhlbiB0cmFuc2xhdGUgd2hlbiBldmVyeXRoaW5nIGlzIGRvbmVcbiAgICAgICAgdGFwUG9pbnQgPSB7XG4gICAgICAgICAgb2Zmc2V0OiB0cnVlLFxuICAgICAgICAgIHg6IChnZXN0dXJlLm9wdGlvbnMueCB8fCAwKSxcbiAgICAgICAgICB5OiAoZ2VzdHVyZS5vcHRpb25zLnkgfHwgMClcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IHRvdWNoU3RhdGVPYmplY3QgPSB7XG4gICAgICAgICAgdGltZU9mZnNldDogMC4yLFxuICAgICAgICAgIHRvdWNoOiBbXG4gICAgICAgICAgICB0YXBQb2ludFxuICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgICAgdG91Y2hTdGF0ZU9iamVjdHMucHVzaCh0b3VjaFN0YXRlT2JqZWN0KTtcbiAgICAgICAgYXdhaXQgY3ljbGVUaHJvdWdoR2VzdHVyZXMoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gaW4gdGhpcyBjYXNlIHdlIG5lZWQgdGhlIHByZXZpb3VzIGVudHJ5J3MgdGFwIHBvaW50XG4gICAgICB0YXBQb2ludCA9IGZhbHNlOyAvLyB0ZW1wb3JhcnkgbWFya2VyXG4gICAgICBsZXQgb2Zmc2V0ID0gMC4yO1xuICAgICAgaWYgKGdlc3R1cmUuYWN0aW9uID09PSAnd2FpdCcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBnZXN0dXJlLm9wdGlvbnMubXMgIT09ICd1bmRlZmluZWQnIHx8IGdlc3R1cmUub3B0aW9ucy5tcyAhPT0gbnVsbCkge1xuICAgICAgICAgIG9mZnNldCA9IChwYXJzZUludChnZXN0dXJlLm9wdGlvbnMubXMsIDEwKSAvIDEwMDApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsZXQgdG91Y2hTdGF0ZU9iamVjdCA9IHtcbiAgICAgICAgdGltZU9mZnNldDogb2Zmc2V0LFxuICAgICAgICB0b3VjaDogW1xuICAgICAgICAgIHRhcFBvaW50XG4gICAgICAgIF1cbiAgICAgIH07XG4gICAgICB0b3VjaFN0YXRlT2JqZWN0cy5wdXNoKHRvdWNoU3RhdGVPYmplY3QpO1xuICAgICAgYXdhaXQgY3ljbGVUaHJvdWdoR2VzdHVyZXMoKTtcbiAgICB9XG4gIH07XG5cbiAgYXdhaXQgY3ljbGVUaHJvdWdoR2VzdHVyZXMoKTtcbiAgcmV0dXJuIHRvdWNoU3RhdGVPYmplY3RzO1xufTtcblxubGV0IG1lcmdlU3RhdGVzID0gZnVuY3Rpb24gKHN0YXRlcykge1xuICBsZXQgZ2V0U2xpY2UgPSBmdW5jdGlvbiAoc3RhdGVzLCBpbmRleCkge1xuICAgIGxldCBhcnJheSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBhcnJheS5wdXNoKHN0YXRlc1tpXVtpbmRleF0pO1xuICAgIH1cblxuICAgIHJldHVybiBhcnJheTtcbiAgfTtcblxuICBsZXQgdGltZVNlcXVlbmNlID0gZnVuY3Rpb24gKHN0YXRlcykge1xuICAgIGxldCBzZXEgPSBbXTtcbiAgICBfLmVhY2goc3RhdGVzLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgIGxldCB0aW1lcyA9IF8ubWFwKHN0YXRlLCBcInRpbWVcIik7XG4gICAgICBzZXEgPSBfLnVuaW9uKHNlcSwgdGltZXMpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHNlcS5zb3J0KCk7XG4gIH07XG5cbiAgLy8gZm9yIG5vdyB3ZSB3aWxsIGp1c3QgYXNzdW1lIHRoYXQgdGhlIHRpbWVzIGxpbmUgdXBcbiAgbGV0IG1lcmdlZCA9IFtdO1xuICBfLmVhY2godGltZVNlcXVlbmNlKHN0YXRlcyksIGZ1bmN0aW9uICh0aW1lLCBpbmRleCkge1xuICAgIGxldCBzbGljZSA9IGdldFNsaWNlKHN0YXRlcywgaW5kZXgpO1xuICAgIGxldCBvYmogPSB7XG4gICAgICB0aW1lLFxuICAgICAgdG91Y2g6IFtdXG4gICAgfTtcbiAgICBfLmVhY2goc2xpY2UsIGZ1bmN0aW9uIChhY3Rpb24pIHtcbiAgICAgIG9iai50b3VjaC5wdXNoKGFjdGlvbi50b3VjaFswXSk7XG4gICAgfSk7XG4gICAgbWVyZ2VkLnB1c2gob2JqKTtcbiAgfSk7XG4gIHJldHVybiBtZXJnZWQ7XG59O1xuXG5jb21tYW5kcy5wZXJmb3JtTXVsdGlBY3Rpb24gPSBhc3luYyBmdW5jdGlvbiAoYWN0aW9ucywgZWwpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuXG4gIGVsID0gdW53cmFwRWwoZWwpO1xuICAvLyBUT0RPOiB3aHkgZWxlbWVudElkIGlzIG5vdCB1c2VkXG4gIGxldCBzdGF0ZXMgPSBbXTtcbiAgbGV0IGN5Y2xlVGhyb3VnaEFjdGlvbnMgPSBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGFjdGlvbiA9IGFjdGlvbnMuc2hpZnQoKTtcblxuICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBsZXQgbWVyZ2VkU3RhdGVzID0gbWVyZ2VTdGF0ZXMoc3RhdGVzKTtcbiAgICAgIGlmICh0aGlzLmlzUGluY2hBbmRab29tKG1lcmdlZFN0YXRlcykpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVQaW5jaEFuZFpvb20obWVyZ2VkU3RhdGVzKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQgKGB0YXJnZXQudG91Y2goJHtKU09OLnN0cmluZ2lmeShtZXJnZWRTdGF0ZXMpfSlgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCB2YWwgPSBhd2FpdCB0aGlzLnBhcnNlVG91Y2goYWN0aW9uKTtcbiAgICBzdGF0ZXMucHVzaCh2YWwpO1xuICAgIGF3YWl0IGN5Y2xlVGhyb3VnaEFjdGlvbnMoKTtcbiAgfTtcbiAgYXdhaXQgY3ljbGVUaHJvdWdoQWN0aW9ucygpO1xufTtcblxuaGVscGVycy5tb2JpbGVTY3JvbGwgPSBhc3luYyBmdW5jdGlvbiAob3B0cz17fSkge1xuICBsZXQgZGlyZWN0aW9uID0gb3B0cy5kaXJlY3Rpb247XG4gIGxldCBlbCA9IG9wdHMuZWxlbWVudDtcbiAgZWwgPSB1bndyYXBFbChlbCk7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgLy8gbm90IGltcGxlbWVudGVkIHlldCBpbiB3ZWJcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfSBlbHNlIHtcbiAgICBkaXJlY3Rpb24gPSBfLmNhcGl0YWxpemUoZGlyZWN0aW9uKTtcbiAgICBsZXQgY29tbWFuZDtcbiAgICBpZiAoXy5pc051bGwoZWwpIHx8IF8uaXNVbmRlZmluZWQoZWwpKSB7XG4gICAgICAvLyBCeSBkZWZhdWx0LCBzY3JvbGwgdGhlIGZpcnN0IHNjcm9sbHZpZXcuXG4gICAgICBjb21tYW5kID0gYGF1LnNjcm9sbEZpcnN0VmlldygnJHtkaXJlY3Rpb259JylgO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBpZiBlbGVtZW50IGlzIGRlZmluZWQsIGNhbGwgc2Nyb2xsTGVmdCwgc2Nyb2xsUmlnaHQsIHNjcm9sbFVwLCBhbmQgc2Nyb2xsRG93biBvbiB0aGUgZWxlbWVudC5cbiAgICAgIGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS5zY3JvbGwke2RpcmVjdGlvbn0oKWA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghXy5pbmNsdWRlcyhlcnIubWVzc2FnZSwgJ2tBWEVycm9yRmFpbHVyZScpKSB0aHJvdyBlcnI7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY3VybHlcblxuICAgICAgbG9nZ2VyLndhcm4oJ1JlY2VpdmVkIGtBWEVycm9yRmFpbHVyZSwgZ2VuZXJhbGx5IGluZGljYXRpbmcgYW4gYXR0ZW1wdCAnICtcbiAgICAgICAgICAgICAgICAgICd0byBzY3JvbGwgcGFzdCB0aGUgZW5kIG9mIHRoZSB2aWV3LiBDb250aW51aW5nLicpO1xuICAgIH1cbiAgfVxufTtcblxuY29tbWFuZHMuZmxpY2sgPSBhc3luYyBmdW5jdGlvbiAoZWwsIHhzcGVlZCwgeXNwZWVkLCB4b2Zmc2V0LCB5b2Zmc2V0LCBzcGVlZCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgaWYgKF8uZXZlcnkoW2VsLCB4b2Zmc2V0LCB5b2Zmc2V0LCBzcGVlZF0sIChwKSA9PiB7cmV0dXJuICFfLmlzTnVsbChwKSAmJiAhXy5pc1VuZGVmaW5lZChwKTt9KSkge1xuICAgIGF3YWl0IHRoaXMuZmxpY2tFbGVtZW50KGVsLCB4b2Zmc2V0LCB5b2Zmc2V0LCBzcGVlZCk7XG4gIH0gZWxzZSBpZiAoXy5ldmVyeShbeHNwZWVkLCB5c3BlZWRdLCAocCkgPT4ge3JldHVybiAhXy5pc051bGwocCkgJiYgIV8uaXNVbmRlZmluZWQocCk7fSkpIHtcbiAgICBhd2FpdCB0aGlzLnh5U3BlZWRGbGljayh4c3BlZWQsIHlzcGVlZCk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXJyb3IoXG4gICAgICAnQmFkIGZsaWNrIHBhcmFtZXRlcnMsIHBhc3MgZWl0aGVyICh4c3BlZWQsIHlzcGVlZCkgb3IgKGVsZW1lbnQsIHhvZmZzZXQsIHlvZmZzZXQsIHNwZWVkKSEnKTtcbiAgfVxufTtcblxuaGVscGVycy54eVNwZWVkRmxpY2sgPSBhc3luYyBmdW5jdGlvbiAoeFNwZWVkLCB5U3BlZWQpIHtcbiAgbGV0IGNvbW1hbmQgPSBgYXUudG91Y2hGbGlja0Zyb21TcGVlZCgke3hTcGVlZH0sJHt5U3BlZWR9KWA7XG4gIGF3YWl0IEIuYWxsKFtcbiAgICB0aGlzLnVpQXV0b0NsaWVudC5zZW5kQ29tbWFuZChjb21tYW5kKSxcbiAgICBCLmRlbGF5KEZMSUNLX01TKVxuICBdKTtcbn07XG5cbmhlbHBlcnMuZmxpY2tFbGVtZW50ID0gYXN5bmMgZnVuY3Rpb24gKGVsLCB4b2Zmc2V0LCB5b2Zmc2V0LCBzcGVlZCkge1xuICBlbCA9IHVud3JhcEVsKGVsKTtcbiAgbGV0IGNvbW1hbmQgPSBcIlwiO1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIC8vIHNwZWVkIGlzIG5vdCB1c2VkIGJlY2F1c2UgdW5kZXJseWluZyBVSUFUYXJnZXQuZmxpY2tGcm9tVG8gZG9lc24ndCBzdXBwb3J0IGl0XG4gICAgYXdhaXQgdGhpcy53ZWJGbGlja0VsZW1lbnQoZWwsIHhvZmZzZXQsIHlvZmZzZXQpO1xuICB9IGVsc2Uge1xuICAgIGNvbW1hbmQgPSBgYXUuZ2V0RWxlbWVudCgnJHtlbH0nKS50b3VjaEZsaWNrKCR7eG9mZnNldH0sJHt5b2Zmc2V0fSwke3NwZWVkfSlgO1xuICAgIGF3YWl0IEIuYWxsKFtcbiAgICAgIHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpLFxuICAgICAgQi5kZWxheShGTElDS19NUylcbiAgICBdKTtcbiAgfVxufTtcblxuLy8gVE9ETzogbWF5YmUgcmVuYW1lIHRoaXMgaW4gbWpzb253cFxuY29tbWFuZHMubW9iaWxlU2hha2UgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKFwiYXUuc2hha2UoKVwiKTtcbn07XG5cbmNvbW1hbmRzLm1vdmVUbyA9IGFzeW5jIGZ1bmN0aW9uIChlbCwgeG9mZnNldCA9IDAsIHlvZmZzZXQgPSAwKSB7XG4gIGVsID0gdW53cmFwRWwoZWwpO1xuXG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IHt4LCB5fSA9IGF3YWl0IHRoaXMuZ2V0TG9jYXRpb24oZWwpO1xuICAgIGxldCBjb29yZHMgPSB7XG4gICAgICB4OiB4ICsgeG9mZnNldCxcbiAgICAgIHk6IHkgKyB5b2Zmc2V0XG4gICAgfTtcbiAgICB0aGlzLmN1cldlYkNvb3JkcyA9IGNvb3JkcztcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIGxldCByZWxDb29yZHMgPSB7eDogeG9mZnNldCwgeTogeW9mZnNldH07XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlQXRvbSgnbW92ZV9tb3VzZScsIFthdG9tc0VsZW1lbnQsIHJlbENvb3Jkc10pO1xuICB9IGVsc2Uge1xuICAgIGlmIChfLmlzTnVsbChlbCkgfHwgXy5pc1VuZGVmaW5lZChlbCkpIHtcbiAgICAgIGlmICghdGhpcy5jdXJDb29yZHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IGVycm9ycy5Vbmtub3duRXhjZXB0aW9uKFxuICAgICAgICAgICdDdXJyZW50IGN1cnNvciBwb3NpdGlvbiB1bmtub3duLCBwbGVhc2UgdXNlIG1vdmVUbyB3aXRoIGFuIGVsZW1lbnQgdGhlIGZpcnN0IHRpbWUuJyk7XG4gICAgICB9XG4gICAgICB0aGlzLmN1ckNvb3JkcyA9IHtcbiAgICAgICAgeDogdGhpcy5jdXJDb29yZHMueCArIHhvZmZzZXQsXG4gICAgICAgIHk6IHRoaXMuY3VyQ29vcmRzLnkgKyB5b2Zmc2V0XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZWxQb3MgPSBhd2FpdCB0aGlzLmdldExvY2F0aW9uKGVsKTtcbiAgICAgIHRoaXMuY3VyQ29vcmRzID0ge1xuICAgICAgICB4OiBlbFBvcy54ICsgeG9mZnNldCxcbiAgICAgICAgeTogZWxQb3MueSArIHlvZmZzZXRcbiAgICAgIH07XG4gICAgfVxuICB9XG59O1xuXG5PYmplY3QuYXNzaWduKGV4dGVuc2lvbnMsIGNvbW1hbmRzLCBoZWxwZXJzKTtcbmV4cG9ydCB7IGNvbW1hbmRzLCBoZWxwZXJzIH07XG5leHBvcnQgZGVmYXVsdCBleHRlbnNpb25zO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
