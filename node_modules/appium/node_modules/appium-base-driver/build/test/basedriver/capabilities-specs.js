'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _libBasedriverCapabilities = require('../../lib/basedriver/capabilities');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

_chai2['default'].use(_chaiAsPromised2['default']);
_chai2['default'].should();

describe('caps', function () {

  // Tests based on: https://www.w3.org/TR/webdriver/#dfn-validate-caps
  describe('#validateCaps', function () {
    it('returns invalid argument error if "capability" is not a JSON object (1)', function () {
      var _arr = [undefined, null, 1, true, 'string'];

      var _loop = function () {
        var arg = _arr[_i];
        (function () {
          (0, _libBasedriverCapabilities.validateCaps)(arg);
        }).should['throw'](/must be a JSON object/);
      };

      for (var _i = 0; _i < _arr.length; _i++) {
        _loop();
      }
    });

    it('returns result {} by default if caps is empty object and no constraints provided (2)', function () {
      (0, _libBasedriverCapabilities.validateCaps)({}).should.deep.equal({});
    });

    describe('throws errors if constraints are not met', function () {
      it('returns invalid argument error if "present" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({}, { foo: { presence: true } });
        }).should['throw'](/foo can't be blank/);
      });

      it('returns the capability that was passed in if "skipPresenceConstraint" is false', function () {
        (0, _libBasedriverCapabilities.validateCaps)({}, { foo: { presence: true } }, true).should.deep.equal({});
      });

      it('returns invalid argument error if "isString" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 1 }, { foo: { isString: true } });
        }).should['throw'](/foo must be of type string/);
      });

      it('returns invalid argument error if "isNumber" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 'bar' }, { foo: { isNumber: true } });
        }).should['throw'](/foo must be of type number/);
      });

      it('returns invalid argument error if "isBoolean" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 'bar' }, { foo: { isBoolean: true } });
        }).should['throw'](/foo must be of type boolean/);
      });

      it('returns invalid argument error if "inclusion" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: '3' }, { foo: { inclusionCaseInsensitive: ['1', '2'] } });
        }).should['throw'](/foo 3 not part of 1,2./);
      });

      it('returns invalid argument error if "inclusionCaseInsensitive" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 'a' }, { foo: { inclusion: ['A', 'B', 'C'] } });
        }).should['throw'](/foo a is not included in the list/);
      });
    });

    it('should not throw errors if constraints are met', function () {
      var caps = {
        number: 1,
        string: 'string',
        present: 'present',
        extra: 'extra'
      };

      var constraints = {
        number: { isNumber: true },
        string: { isString: true },
        present: { presence: true },
        notPresent: { presence: false }
      };

      (0, _libBasedriverCapabilities.validateCaps)(caps, constraints).should.deep.equal(caps);
    });
  });

  // Tests based on: https://www.w3.org/TR/webdriver/#dfn-merging-caps
  describe('#mergeCaps', function () {
    it('returns a result that is {} by default (1)', function () {
      (0, _libBasedriverCapabilities.mergeCaps)().should.deep.equal({});
    });

    it('returns a result that matches primary by default (2, 3)', function () {
      (0, _libBasedriverCapabilities.mergeCaps)({ hello: 'world' }).should.deep.equal({ hello: 'world' });
    });

    it('returns invalid argument error if primary and secondary have matching properties (4)', function () {
      (function () {
        return (0, _libBasedriverCapabilities.mergeCaps)({ hello: 'world' }, { hello: 'whirl' });
      }).should['throw'](/property hello should not exist on both primary and secondary/);
    });

    it('returns a result with keys from primary and secondary together', function () {
      var primary = {
        a: 'a',
        b: 'b'
      };
      var secondary = {
        c: 'c',
        d: 'd'
      };
      (0, _libBasedriverCapabilities.mergeCaps)(primary, secondary).should.deep.equal({
        a: 'a', b: 'b', c: 'c', d: 'd'
      });
    });
  });

  // Tests based on: https://www.w3.org/TR/webdriver/#dfn-matching-caps
  describe('#matchCaps', function () {
    // TODO: Do we need this?
  });

  // Tests based on: https://www.w3.org/TR/webdriver/#processing-caps
  describe('#parseCaps', function () {
    var caps = undefined;

    beforeEach(function () {
      caps = {};
    });

    it('should return invalid argument if no caps object provided', function () {
      (function () {
        return (0, _libBasedriverCapabilities.parseCaps)();
      }).should['throw'](/must be a JSON object/);
    });

    it('sets "requiredCaps" to property named "alwaysMatch" (2)', function () {
      caps.alwaysMatch = { hello: 'world' };
      (0, _libBasedriverCapabilities.parseCaps)(caps).requiredCaps.should.deep.equal(caps.alwaysMatch);
    });

    it('sets "requiredCaps" to empty JSON object if "alwaysMatch" is not an object (2.1)', function () {
      (0, _libBasedriverCapabilities.parseCaps)(caps).requiredCaps.should.deep.equal({});
    });

    it('returns invalid argument error if "requiredCaps" don\'t match "constraints" (2.2)', function () {
      caps.alwaysMatch = { foo: 1 };
      (function () {
        return (0, _libBasedriverCapabilities.parseCaps)(caps, { foo: { isString: true } });
      }).should['throw'](/foo must be of type string/);
    });

    it('sets "allFirstMatchCaps" to property named "firstMatch" (3)', function () {
      (0, _libBasedriverCapabilities.parseCaps)({}, []).allFirstMatchCaps.should.deep.equal([]);
    });

    it('sets "allFirstMatchCaps" to [] if "firstMatch" is undefined (3.1)', function () {
      (0, _libBasedriverCapabilities.parseCaps)({}).allFirstMatchCaps.should.deep.equal([]);
    });

    it('returns invalid argument error if "firstMatch" is not an array and is not undefined (3.2)', function () {
      var _arr2 = [null, 1, true, 'string'];

      for (var _i2 = 0; _i2 < _arr2.length; _i2++) {
        var arg = _arr2[_i2];
        caps.firstMatch = arg;
        (function () {
          (0, _libBasedriverCapabilities.parseCaps)(caps);
        }).should['throw'](/must be a JSON array or undefined/);
      }
    });

    it('has "validatedFirstMatchCaps" property that is [] by default (4)', function () {
      (0, _libBasedriverCapabilities.parseCaps)(caps).validatedFirstMatchCaps.should.deep.equal([]);
    });

    describe('returns a "validatedFirstMatchCaps" array (5)', function () {
      it('that equals "firstMatch" if firstMatch is one empty object and there are no constraints', function () {
        caps.firstMatch = [{}];
        (0, _libBasedriverCapabilities.parseCaps)(caps).validatedFirstMatchCaps.should.deep.equal(caps.firstMatch);
      });

      it('returns invalid argument error if firstMatch array\'s first argument fails constraints', function () {
        caps.firstMatch = [{}];
        (function () {
          return (0, _libBasedriverCapabilities.parseCaps)(caps, { foo: { presence: true } });
        }).should['throw'](/foo can't be blank/);
      });

      it('that equals firstMatch if firstMatch contains two objects that pass the provided constraints', function () {
        caps.alwaysMatch = {
          foo: 'bar'
        };
        caps.firstMatch = [{ foo: 'bar1' }, { foo: 'bar2' }];

        var constraints = {
          foo: {
            presence: true,
            isString: true
          }
        };

        (0, _libBasedriverCapabilities.parseCaps)(caps, constraints).validatedFirstMatchCaps.should.deep.equal(caps.firstMatch);
      });

      it('returns invalid argument error if the firstMatch[2] is not an object', function () {
        caps.firstMatch = [{ foo: 'bar' }, 'foo'];
        (function () {
          return (0, _libBasedriverCapabilities.parseCaps)(caps, {});
        }).should['throw'](/must be a JSON object/);
      });
    });

    describe('returns a matchedCaps object (6)', function () {
      beforeEach(function () {
        caps.alwaysMatch = { hello: 'world' };
      });

      it('which is same as alwaysMatch if firstMatch array is not provided', function () {
        (0, _libBasedriverCapabilities.parseCaps)(caps).matchedCaps.should.deep.equal({ hello: 'world' });
      });

      it('merges caps together', function () {
        caps.firstMatch = [{ foo: 'bar' }];
        (0, _libBasedriverCapabilities.parseCaps)(caps).matchedCaps.should.deep.equal({ hello: 'world', foo: 'bar' });
      });

      it('with merged caps', function () {
        caps.firstMatch = [{ hello: 'bar', foo: 'foo' }, { foo: 'bar' }];
        (0, _libBasedriverCapabilities.parseCaps)(caps).matchedCaps.should.deep.equal({ hello: 'world', foo: 'bar' });
      });
    });
  });

  describe('#processCaps', function () {
    it('should return "alwaysMatch" if "firstMatch" and "constraints" were not provided', function () {
      (0, _libBasedriverCapabilities.processCapabilities)({}).should.deep.equal({});
    });

    it('should return merged caps', function () {
      (0, _libBasedriverCapabilities.processCapabilities)({
        alwaysMatch: { hello: 'world' },
        firstMatch: [{ foo: 'bar' }]
      }).should.deep.equal({ hello: 'world', foo: 'bar' });
    });

    it('should strip out the "appium:" prefix for non-standard capabilities', function () {
      (0, _libBasedriverCapabilities.processCapabilities)({
        alwaysMatch: { 'appium:hello': 'world' },
        firstMatch: [{ 'appium:foo': 'bar' }]
      }).should.deep.equal({ hello: 'world', foo: 'bar' });
    });

    it('should throw an exception if a standard capability (https://www.w3.org/TR/webdriver/#dfn-table-of-standard-capabilities) is prefixed', function () {
      (function () {
        return (0, _libBasedriverCapabilities.processCapabilities)({
          alwaysMatch: { 'appium:platformName': 'Whatevz' },
          firstMatch: [{ 'appium:browserName': 'Anything' }]
        });
      }).should['throw'](/standard capabilities/);
    });

    it('should not throw an exception if presence constraint is not met on a firstMatch capability', function () {
      var caps = (0, _libBasedriverCapabilities.processCapabilities)({
        alwaysMatch: { 'platformName': 'Fake', 'appium:fakeCap': 'foobar' },
        firstMatch: [{ 'foo': 'bar' }]
      }, {
        platformName: {
          presence: true
        },
        fakeCap: {
          presence: true
        }
      });

      caps.platformName.should.equal('Fake');
      caps.fakeCap.should.equal('foobar');
      caps.foo.should.equal('bar');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9jYXBhYmlsaXRpZXMtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozt5Q0FBd0UsbUNBQW1DOztvQkFDMUYsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7QUFFN0Msa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQztBQUN6QixrQkFBSyxNQUFNLEVBQUUsQ0FBQzs7QUFFZCxRQUFRLENBQUMsTUFBTSxFQUFFLFlBQVk7OztBQUczQixVQUFRLENBQUMsZUFBZSxFQUFFLFlBQVk7QUFDcEMsTUFBRSxDQUFDLHlFQUF5RSxFQUFFLFlBQVk7aUJBQ3hFLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQzs7O0FBQS9DLFlBQUksR0FBRyxXQUFBLENBQUE7QUFDVixTQUFDLFlBQVk7QUFBRSx1REFBYSxHQUFHLENBQUMsQ0FBQztTQUFFLENBQUEsQ0FBRSxNQUFNLFNBQU0sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDOzs7QUFEN0UsK0NBQXNEOztPQUVyRDtLQUNGLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsc0ZBQXNGLEVBQUUsWUFBWTtBQUNyRyxtREFBYSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUN4QyxDQUFDLENBQUM7O0FBRUgsWUFBUSxDQUFDLDBDQUEwQyxFQUFFLFlBQVk7QUFDL0QsUUFBRSxDQUFDLDRFQUE0RSxFQUFFLFlBQVk7QUFDM0YsU0FBQztpQkFBTSw2Q0FBYSxFQUFFLEVBQUUsRUFBQyxHQUFHLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLEVBQUMsQ0FBQztVQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQztPQUN0RixDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLGdGQUFnRixFQUFFLFlBQVk7QUFDL0YscURBQWEsRUFBRSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxFQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7T0FDdkUsQ0FBQyxDQUFDOztBQUVILFFBQUUsQ0FBQyw2RUFBNkUsRUFBRSxZQUFZO0FBQzVGLFNBQUM7aUJBQU0sNkNBQWEsRUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxHQUFHLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDLEVBQUMsQ0FBQztVQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsNEJBQTRCLENBQUMsQ0FBQztPQUNwRyxDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLDZFQUE2RSxFQUFFLFlBQVk7QUFDNUYsU0FBQztpQkFBTSw2Q0FBYSxFQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUMsRUFBRSxFQUFDLEdBQUcsRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUMsRUFBQyxDQUFDO1VBQUEsQ0FBRSxNQUFNLFNBQU0sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO09BQ3hHLENBQUMsQ0FBQzs7QUFFSCxRQUFFLENBQUMsOEVBQThFLEVBQUUsWUFBWTtBQUM3RixTQUFDO2lCQUFNLDZDQUFhLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBQyxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBQyxFQUFDLENBQUM7VUFBQSxDQUFFLE1BQU0sU0FBTSxDQUFDLDZCQUE2QixDQUFDLENBQUM7T0FDMUcsQ0FBQyxDQUFDOztBQUVILFFBQUUsQ0FBQyw4RUFBOEUsRUFBRSxZQUFZO0FBQzdGLFNBQUM7aUJBQU0sNkNBQWEsRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLEVBQUUsRUFBQyxHQUFHLEVBQUUsRUFBQyx3QkFBd0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBQyxFQUFDLENBQUM7VUFBQSxDQUFFLE1BQU0sU0FBTSxDQUFDLHdCQUF3QixDQUFDLENBQUM7T0FDeEgsQ0FBQyxDQUFDOztBQUVILFFBQUUsQ0FBQyw2RkFBNkYsRUFBRSxZQUFZO0FBQzVHLFNBQUM7aUJBQU0sNkNBQWEsRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLEVBQUUsRUFBQyxHQUFHLEVBQUUsRUFBQyxTQUFTLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFDLEVBQUMsQ0FBQztVQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsbUNBQW1DLENBQUMsQ0FBQztPQUN6SCxDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLGdEQUFnRCxFQUFFLFlBQVk7QUFDL0QsVUFBSSxJQUFJLEdBQUc7QUFDVCxjQUFNLEVBQUUsQ0FBQztBQUNULGNBQU0sRUFBRSxRQUFRO0FBQ2hCLGVBQU8sRUFBRSxTQUFTO0FBQ2xCLGFBQUssRUFBRSxPQUFPO09BQ2YsQ0FBQzs7QUFFRixVQUFJLFdBQVcsR0FBRztBQUNoQixjQUFNLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxFQUFDO0FBQ3hCLGNBQU0sRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUM7QUFDeEIsZUFBTyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQztBQUN6QixrQkFBVSxFQUFFLEVBQUMsUUFBUSxFQUFFLEtBQUssRUFBQztPQUM5QixDQUFDOztBQUVGLG1EQUFhLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUN6RCxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7OztBQUdILFVBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBWTtBQUNqQyxNQUFFLENBQUMsNENBQTRDLEVBQUUsWUFBWTtBQUMzRCxpREFBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ25DLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMseURBQXlELEVBQUUsWUFBWTtBQUN4RSxnREFBVSxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7S0FDakUsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxzRkFBc0YsRUFBRSxZQUFZO0FBQ3JHLE9BQUM7ZUFBTSwwQ0FBVSxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUMsRUFBRSxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUMsQ0FBQztRQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsK0RBQStELENBQUMsQ0FBQztLQUNySSxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLGdFQUFnRSxFQUFFLFlBQVk7QUFDL0UsVUFBSSxPQUFPLEdBQUc7QUFDWixTQUFDLEVBQUUsR0FBRztBQUNOLFNBQUMsRUFBRSxHQUFHO09BQ1AsQ0FBQztBQUNGLFVBQUksU0FBUyxHQUFHO0FBQ2QsU0FBQyxFQUFFLEdBQUc7QUFDTixTQUFDLEVBQUUsR0FBRztPQUNQLENBQUM7QUFDRixnREFBVSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7QUFDOUMsU0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUc7T0FDL0IsQ0FBQyxDQUFDO0tBQ0osQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOzs7QUFHSCxVQUFRLENBQUMsWUFBWSxFQUFFLFlBQVk7O0dBRWxDLENBQUMsQ0FBQzs7O0FBR0gsVUFBUSxDQUFDLFlBQVksRUFBRSxZQUFZO0FBQ2pDLFFBQUksSUFBSSxZQUFBLENBQUM7O0FBRVQsY0FBVSxDQUFDLFlBQU07QUFDZixVQUFJLEdBQUcsRUFBRSxDQUFDO0tBQ1gsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQywyREFBMkQsRUFBRSxZQUFZO0FBQzFFLE9BQUM7ZUFBTSwyQ0FBVztRQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQztLQUMzRCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLHlEQUF5RCxFQUFFLFlBQVk7QUFDeEUsVUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUMsQ0FBQztBQUNwQyxnREFBVSxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0tBQ2xFLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsa0ZBQWtGLEVBQUUsWUFBWTtBQUNqRyxnREFBVSxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDcEQsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxtRkFBbUYsRUFBRSxZQUFZO0FBQ2xHLFVBQUksQ0FBQyxXQUFXLEdBQUcsRUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFDLENBQUM7QUFDNUIsT0FBQztlQUFNLDBDQUFVLElBQUksRUFBRSxFQUFDLEdBQUcsRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUMsRUFBQyxDQUFDO1FBQUEsQ0FBRSxNQUFNLFNBQU0sQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO0tBQzdGLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsNkRBQTZELEVBQUUsWUFBWTtBQUM1RSxnREFBVSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDM0QsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxtRUFBbUUsRUFBRSxZQUFZO0FBQ2xGLGdEQUFVLEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ3ZELENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsMkZBQTJGLEVBQUUsWUFBWTtrQkFDMUYsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUM7O0FBQXpDLG1EQUEyQztBQUF0QyxZQUFJLEdBQUcsYUFBQSxDQUFBO0FBQ1YsWUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUM7QUFDdEIsU0FBQyxZQUFZO0FBQUUsb0RBQVUsSUFBSSxDQUFDLENBQUM7U0FBRSxDQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsbUNBQW1DLENBQUMsQ0FBQztPQUN0RjtLQUNGLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsa0VBQWtFLEVBQUUsWUFBWTtBQUNqRixnREFBVSxJQUFJLENBQUMsQ0FBQyx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztLQUMvRCxDQUFDLENBQUM7O0FBRUgsWUFBUSxDQUFDLCtDQUErQyxFQUFFLFlBQVk7QUFDcEUsUUFBRSxDQUFDLHlGQUF5RixFQUFFLFlBQVk7QUFDeEcsWUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZCLGtEQUFVLElBQUksQ0FBQyxDQUFDLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztPQUM1RSxDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLHdGQUF3RixFQUFFLFlBQVk7QUFDdkcsWUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZCLFNBQUM7aUJBQU0sMENBQVUsSUFBSSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxFQUFDLENBQUM7VUFBQSxDQUFFLE1BQU0sU0FBTSxDQUFDLG9CQUFvQixDQUFDLENBQUM7T0FDckYsQ0FBQyxDQUFDOztBQUVILFFBQUUsQ0FBQyw4RkFBOEYsRUFBRSxZQUFZO0FBQzdHLFlBQUksQ0FBQyxXQUFXLEdBQUc7QUFDakIsYUFBRyxFQUFFLEtBQUs7U0FDWCxDQUFDO0FBQ0YsWUFBSSxDQUFDLFVBQVUsR0FBRyxDQUNoQixFQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUMsRUFDYixFQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUMsQ0FDZCxDQUFDOztBQUVGLFlBQUksV0FBVyxHQUFHO0FBQ2hCLGFBQUcsRUFBRTtBQUNILG9CQUFRLEVBQUUsSUFBSTtBQUNkLG9CQUFRLEVBQUUsSUFBSTtXQUNmO1NBQ0YsQ0FBQzs7QUFFRixrREFBVSxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUMsdUJBQXVCLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO09BQ3pGLENBQUMsQ0FBQzs7QUFFSCxRQUFFLENBQUMsc0VBQXNFLEVBQUUsWUFBWTtBQUNyRixZQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsRUFBQyxHQUFHLEVBQUUsS0FBSyxFQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDeEMsU0FBQztpQkFBTSwwQ0FBVSxJQUFJLEVBQUUsRUFBRSxDQUFDO1VBQUEsQ0FBRSxNQUFNLFNBQU0sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO09BQ25FLENBQUMsQ0FBQztLQUNKLENBQUMsQ0FBQzs7QUFFSCxZQUFRLENBQUMsa0NBQWtDLEVBQUUsWUFBWTtBQUN2RCxnQkFBVSxDQUFDLFlBQU07QUFDZixZQUFJLENBQUMsV0FBVyxHQUFHLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDO09BQ3JDLENBQUMsQ0FBQzs7QUFFSCxRQUFFLENBQUMsa0VBQWtFLEVBQUUsWUFBWTtBQUNqRixrREFBVSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztPQUNqRSxDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLHNCQUFzQixFQUFFLFlBQVk7QUFDckMsWUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7QUFDakMsa0RBQVUsSUFBSSxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztPQUM3RSxDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLGtCQUFrQixFQUFFLFlBQVk7QUFDakMsWUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDLEVBQUUsRUFBQyxHQUFHLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztBQUM3RCxrREFBVSxJQUFJLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO09BQzdFLENBQUMsQ0FBQztLQUNKLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsY0FBYyxFQUFFLFlBQVk7QUFDbkMsTUFBRSxDQUFDLGlGQUFpRixFQUFFLFlBQVk7QUFDaEcsMERBQW9CLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQy9DLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsMkJBQTJCLEVBQUUsWUFBWTtBQUMxQywwREFBb0I7QUFDbEIsbUJBQVcsRUFBRSxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUM7QUFDN0Isa0JBQVUsRUFBRSxDQUFDLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBQyxDQUFDO09BQzNCLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7S0FDcEQsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyxxRUFBcUUsRUFBRSxZQUFZO0FBQ3BGLDBEQUFvQjtBQUNsQixtQkFBVyxFQUFFLEVBQUMsY0FBYyxFQUFFLE9BQU8sRUFBQztBQUN0QyxrQkFBVSxFQUFFLENBQUMsRUFBQyxZQUFZLEVBQUUsS0FBSyxFQUFDLENBQUM7T0FDcEMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztLQUNwRCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLHNJQUFzSSxFQUFFLFlBQVk7QUFDckosT0FBQztlQUFNLG9EQUFvQjtBQUN6QixxQkFBVyxFQUFFLEVBQUMscUJBQXFCLEVBQUUsU0FBUyxFQUFDO0FBQy9DLG9CQUFVLEVBQUUsQ0FBQyxFQUFDLG9CQUFvQixFQUFFLFVBQVUsRUFBQyxDQUFDO1NBQ2pELENBQUM7UUFBQSxDQUFFLE1BQU0sU0FBTSxDQUFDLHVCQUF1QixDQUFDLENBQUM7S0FDM0MsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyw0RkFBNEYsRUFBRSxZQUFZO0FBQzNHLFVBQU0sSUFBSSxHQUFHLG9EQUFvQjtBQUMvQixtQkFBVyxFQUFFLEVBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUM7QUFDakUsa0JBQVUsRUFBRSxDQUFDLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQyxDQUFDO09BQzdCLEVBQUU7QUFDRCxvQkFBWSxFQUFFO0FBQ1osa0JBQVEsRUFBRSxJQUFJO1NBQ2Y7QUFDRCxlQUFPLEVBQUU7QUFDUCxrQkFBUSxFQUFFLElBQUk7U0FDZjtPQUNGLENBQUMsQ0FBQzs7QUFFSCxVQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDdkMsVUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3BDLFVBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM5QixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9iYXNlZHJpdmVyL2NhcGFiaWxpdGllcy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhcnNlQ2FwcywgdmFsaWRhdGVDYXBzLCBtZXJnZUNhcHMsIHByb2Nlc3NDYXBhYmlsaXRpZXMgfSBmcm9tICcuLi8uLi9saWIvYmFzZWRyaXZlci9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5cbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcbmNoYWkuc2hvdWxkKCk7XG5cbmRlc2NyaWJlKCdjYXBzJywgZnVuY3Rpb24gKCkge1xuXG4gIC8vIFRlc3RzIGJhc2VkIG9uOiBodHRwczovL3d3dy53My5vcmcvVFIvd2ViZHJpdmVyLyNkZm4tdmFsaWRhdGUtY2Fwc1xuICBkZXNjcmliZSgnI3ZhbGlkYXRlQ2FwcycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwiY2FwYWJpbGl0eVwiIGlzIG5vdCBhIEpTT04gb2JqZWN0ICgxKScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGZvciAobGV0IGFyZyBvZiBbdW5kZWZpbmVkLCBudWxsLCAxLCB0cnVlLCAnc3RyaW5nJ10pIHtcbiAgICAgICAgKGZ1bmN0aW9uICgpIHsgdmFsaWRhdGVDYXBzKGFyZyk7IH0pLnNob3VsZC50aHJvdygvbXVzdCBiZSBhIEpTT04gb2JqZWN0Lyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyByZXN1bHQge30gYnkgZGVmYXVsdCBpZiBjYXBzIGlzIGVtcHR5IG9iamVjdCBhbmQgbm8gY29uc3RyYWludHMgcHJvdmlkZWQgKDIpJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFsaWRhdGVDYXBzKHt9KS5zaG91bGQuZGVlcC5lcXVhbCh7fSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndGhyb3dzIGVycm9ycyBpZiBjb25zdHJhaW50cyBhcmUgbm90IG1ldCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJwcmVzZW50XCIgY29uc3RyYWludCBub3QgbWV0IG9uIHByb3BlcnR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAoKCkgPT4gdmFsaWRhdGVDYXBzKHt9LCB7Zm9vOiB7cHJlc2VuY2U6IHRydWV9fSkpLnNob3VsZC50aHJvdygvZm9vIGNhbid0IGJlIGJsYW5rLyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3JldHVybnMgdGhlIGNhcGFiaWxpdHkgdGhhdCB3YXMgcGFzc2VkIGluIGlmIFwic2tpcFByZXNlbmNlQ29uc3RyYWludFwiIGlzIGZhbHNlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YWxpZGF0ZUNhcHMoe30sIHtmb286IHtwcmVzZW5jZTogdHJ1ZX19LCB0cnVlKS5zaG91bGQuZGVlcC5lcXVhbCh7fSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiBcImlzU3RyaW5nXCIgY29uc3RyYWludCBub3QgbWV0IG9uIHByb3BlcnR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAoKCkgPT4gdmFsaWRhdGVDYXBzKHtmb286IDF9LCB7Zm9vOiB7aXNTdHJpbmc6IHRydWV9fSkpLnNob3VsZC50aHJvdygvZm9vIG11c3QgYmUgb2YgdHlwZSBzdHJpbmcvKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwiaXNOdW1iZXJcIiBjb25zdHJhaW50IG5vdCBtZXQgb24gcHJvcGVydHknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICgoKSA9PiB2YWxpZGF0ZUNhcHMoe2ZvbzogJ2Jhcid9LCB7Zm9vOiB7aXNOdW1iZXI6IHRydWV9fSkpLnNob3VsZC50aHJvdygvZm9vIG11c3QgYmUgb2YgdHlwZSBudW1iZXIvKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwiaXNCb29sZWFuXCIgY29uc3RyYWludCBub3QgbWV0IG9uIHByb3BlcnR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAoKCkgPT4gdmFsaWRhdGVDYXBzKHtmb286ICdiYXInfSwge2Zvbzoge2lzQm9vbGVhbjogdHJ1ZX19KSkuc2hvdWxkLnRocm93KC9mb28gbXVzdCBiZSBvZiB0eXBlIGJvb2xlYW4vKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwiaW5jbHVzaW9uXCIgY29uc3RyYWludCBub3QgbWV0IG9uIHByb3BlcnR5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAoKCkgPT4gdmFsaWRhdGVDYXBzKHtmb286ICczJ30sIHtmb286IHtpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmU6IFsnMScsICcyJ119fSkpLnNob3VsZC50aHJvdygvZm9vIDMgbm90IHBhcnQgb2YgMSwyLi8pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJpbmNsdXNpb25DYXNlSW5zZW5zaXRpdmVcIiBjb25zdHJhaW50IG5vdCBtZXQgb24gcHJvcGVydHknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICgoKSA9PiB2YWxpZGF0ZUNhcHMoe2ZvbzogJ2EnfSwge2Zvbzoge2luY2x1c2lvbjogWydBJywgJ0InLCAnQyddfX0pKS5zaG91bGQudGhyb3coL2ZvbyBhIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgbGlzdC8pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCB0aHJvdyBlcnJvcnMgaWYgY29uc3RyYWludHMgYXJlIG1ldCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBudW1iZXI6IDEsXG4gICAgICAgIHN0cmluZzogJ3N0cmluZycsXG4gICAgICAgIHByZXNlbnQ6ICdwcmVzZW50JyxcbiAgICAgICAgZXh0cmE6ICdleHRyYScsXG4gICAgICB9O1xuXG4gICAgICBsZXQgY29uc3RyYWludHMgPSB7XG4gICAgICAgIG51bWJlcjoge2lzTnVtYmVyOiB0cnVlfSxcbiAgICAgICAgc3RyaW5nOiB7aXNTdHJpbmc6IHRydWV9LFxuICAgICAgICBwcmVzZW50OiB7cHJlc2VuY2U6IHRydWV9LFxuICAgICAgICBub3RQcmVzZW50OiB7cHJlc2VuY2U6IGZhbHNlfSxcbiAgICAgIH07XG5cbiAgICAgIHZhbGlkYXRlQ2FwcyhjYXBzLCBjb25zdHJhaW50cykuc2hvdWxkLmRlZXAuZXF1YWwoY2Fwcyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIFRlc3RzIGJhc2VkIG9uOiBodHRwczovL3d3dy53My5vcmcvVFIvd2ViZHJpdmVyLyNkZm4tbWVyZ2luZy1jYXBzXG4gIGRlc2NyaWJlKCcjbWVyZ2VDYXBzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdyZXR1cm5zIGEgcmVzdWx0IHRoYXQgaXMge30gYnkgZGVmYXVsdCAoMSknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBtZXJnZUNhcHMoKS5zaG91bGQuZGVlcC5lcXVhbCh7fSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBhIHJlc3VsdCB0aGF0IG1hdGNoZXMgcHJpbWFyeSBieSBkZWZhdWx0ICgyLCAzKScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIG1lcmdlQ2Fwcyh7aGVsbG86ICd3b3JsZCd9KS5zaG91bGQuZGVlcC5lcXVhbCh7aGVsbG86ICd3b3JsZCd9KTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgcHJpbWFyeSBhbmQgc2Vjb25kYXJ5IGhhdmUgbWF0Y2hpbmcgcHJvcGVydGllcyAoNCknLCBmdW5jdGlvbiAoKSB7XG4gICAgICAoKCkgPT4gbWVyZ2VDYXBzKHtoZWxsbzogJ3dvcmxkJ30sIHtoZWxsbzogJ3doaXJsJ30pKS5zaG91bGQudGhyb3coL3Byb3BlcnR5IGhlbGxvIHNob3VsZCBub3QgZXhpc3Qgb24gYm90aCBwcmltYXJ5IGFuZCBzZWNvbmRhcnkvKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGEgcmVzdWx0IHdpdGgga2V5cyBmcm9tIHByaW1hcnkgYW5kIHNlY29uZGFyeSB0b2dldGhlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBwcmltYXJ5ID0ge1xuICAgICAgICBhOiAnYScsXG4gICAgICAgIGI6ICdiJyxcbiAgICAgIH07XG4gICAgICBsZXQgc2Vjb25kYXJ5ID0ge1xuICAgICAgICBjOiAnYycsXG4gICAgICAgIGQ6ICdkJyxcbiAgICAgIH07XG4gICAgICBtZXJnZUNhcHMocHJpbWFyeSwgc2Vjb25kYXJ5KS5zaG91bGQuZGVlcC5lcXVhbCh7XG4gICAgICAgIGE6ICdhJywgYjogJ2InLCBjOiAnYycsIGQ6ICdkJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBUZXN0cyBiYXNlZCBvbjogaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYmRyaXZlci8jZGZuLW1hdGNoaW5nLWNhcHNcbiAgZGVzY3JpYmUoJyNtYXRjaENhcHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVE9ETzogRG8gd2UgbmVlZCB0aGlzP1xuICB9KTtcblxuICAvLyBUZXN0cyBiYXNlZCBvbjogaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYmRyaXZlci8jcHJvY2Vzc2luZy1jYXBzXG4gIGRlc2NyaWJlKCcjcGFyc2VDYXBzJywgZnVuY3Rpb24gKCkge1xuICAgIGxldCBjYXBzO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBjYXBzID0ge307XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBpbnZhbGlkIGFyZ3VtZW50IGlmIG5vIGNhcHMgb2JqZWN0IHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgKCgpID0+IHBhcnNlQ2FwcygpKS5zaG91bGQudGhyb3coL211c3QgYmUgYSBKU09OIG9iamVjdC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3NldHMgXCJyZXF1aXJlZENhcHNcIiB0byBwcm9wZXJ0eSBuYW1lZCBcImFsd2F5c01hdGNoXCIgKDIpJywgZnVuY3Rpb24gKCkge1xuICAgICAgY2Fwcy5hbHdheXNNYXRjaCA9IHtoZWxsbzogJ3dvcmxkJ307XG4gICAgICBwYXJzZUNhcHMoY2FwcykucmVxdWlyZWRDYXBzLnNob3VsZC5kZWVwLmVxdWFsKGNhcHMuYWx3YXlzTWF0Y2gpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3NldHMgXCJyZXF1aXJlZENhcHNcIiB0byBlbXB0eSBKU09OIG9iamVjdCBpZiBcImFsd2F5c01hdGNoXCIgaXMgbm90IGFuIG9iamVjdCAoMi4xKScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHBhcnNlQ2FwcyhjYXBzKS5yZXF1aXJlZENhcHMuc2hvdWxkLmRlZXAuZXF1YWwoe30pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiBcInJlcXVpcmVkQ2Fwc1wiIGRvblxcJ3QgbWF0Y2ggXCJjb25zdHJhaW50c1wiICgyLjIpJywgZnVuY3Rpb24gKCkge1xuICAgICAgY2Fwcy5hbHdheXNNYXRjaCA9IHtmb286IDF9O1xuICAgICAgKCgpID0+IHBhcnNlQ2FwcyhjYXBzLCB7Zm9vOiB7aXNTdHJpbmc6IHRydWV9fSkpLnNob3VsZC50aHJvdygvZm9vIG11c3QgYmUgb2YgdHlwZSBzdHJpbmcvKTtcbiAgICB9KTtcblxuICAgIGl0KCdzZXRzIFwiYWxsRmlyc3RNYXRjaENhcHNcIiB0byBwcm9wZXJ0eSBuYW1lZCBcImZpcnN0TWF0Y2hcIiAoMyknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBwYXJzZUNhcHMoe30sIFtdKS5hbGxGaXJzdE1hdGNoQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2V0cyBcImFsbEZpcnN0TWF0Y2hDYXBzXCIgdG8gW10gaWYgXCJmaXJzdE1hdGNoXCIgaXMgdW5kZWZpbmVkICgzLjEpJywgZnVuY3Rpb24gKCkge1xuICAgICAgcGFyc2VDYXBzKHt9KS5hbGxGaXJzdE1hdGNoQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwiZmlyc3RNYXRjaFwiIGlzIG5vdCBhbiBhcnJheSBhbmQgaXMgbm90IHVuZGVmaW5lZCAoMy4yKScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGZvciAobGV0IGFyZyBvZiBbbnVsbCwgMSwgdHJ1ZSwgJ3N0cmluZyddKSB7XG4gICAgICAgIGNhcHMuZmlyc3RNYXRjaCA9IGFyZztcbiAgICAgICAgKGZ1bmN0aW9uICgpIHsgcGFyc2VDYXBzKGNhcHMpOyB9KS5zaG91bGQudGhyb3coL211c3QgYmUgYSBKU09OIGFycmF5IG9yIHVuZGVmaW5lZC8pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ2hhcyBcInZhbGlkYXRlZEZpcnN0TWF0Y2hDYXBzXCIgcHJvcGVydHkgdGhhdCBpcyBbXSBieSBkZWZhdWx0ICg0KScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHBhcnNlQ2FwcyhjYXBzKS52YWxpZGF0ZWRGaXJzdE1hdGNoQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncmV0dXJucyBhIFwidmFsaWRhdGVkRmlyc3RNYXRjaENhcHNcIiBhcnJheSAoNSknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgndGhhdCBlcXVhbHMgXCJmaXJzdE1hdGNoXCIgaWYgZmlyc3RNYXRjaCBpcyBvbmUgZW1wdHkgb2JqZWN0IGFuZCB0aGVyZSBhcmUgbm8gY29uc3RyYWludHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNhcHMuZmlyc3RNYXRjaCA9IFt7fV07XG4gICAgICAgIHBhcnNlQ2FwcyhjYXBzKS52YWxpZGF0ZWRGaXJzdE1hdGNoQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChjYXBzLmZpcnN0TWF0Y2gpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgZmlyc3RNYXRjaCBhcnJheVxcJ3MgZmlyc3QgYXJndW1lbnQgZmFpbHMgY29uc3RyYWludHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNhcHMuZmlyc3RNYXRjaCA9IFt7fV07XG4gICAgICAgICgoKSA9PiBwYXJzZUNhcHMoY2Fwcywge2Zvbzoge3ByZXNlbmNlOiB0cnVlfX0pKS5zaG91bGQudGhyb3coL2ZvbyBjYW4ndCBiZSBibGFuay8pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCd0aGF0IGVxdWFscyBmaXJzdE1hdGNoIGlmIGZpcnN0TWF0Y2ggY29udGFpbnMgdHdvIG9iamVjdHMgdGhhdCBwYXNzIHRoZSBwcm92aWRlZCBjb25zdHJhaW50cycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2Fwcy5hbHdheXNNYXRjaCA9IHtcbiAgICAgICAgICBmb286ICdiYXInXG4gICAgICAgIH07XG4gICAgICAgIGNhcHMuZmlyc3RNYXRjaCA9IFtcbiAgICAgICAgICB7Zm9vOiAnYmFyMSd9LFxuICAgICAgICAgIHtmb286ICdiYXIyJ30sXG4gICAgICAgIF07XG5cbiAgICAgICAgbGV0IGNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgIGZvbzoge1xuICAgICAgICAgICAgcHJlc2VuY2U6IHRydWUsXG4gICAgICAgICAgICBpc1N0cmluZzogdHJ1ZSxcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgcGFyc2VDYXBzKGNhcHMsIGNvbnN0cmFpbnRzKS52YWxpZGF0ZWRGaXJzdE1hdGNoQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbChjYXBzLmZpcnN0TWF0Y2gpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgdGhlIGZpcnN0TWF0Y2hbMl0gaXMgbm90IGFuIG9iamVjdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2Fwcy5maXJzdE1hdGNoID0gW3tmb286ICdiYXInfSwgJ2ZvbyddO1xuICAgICAgICAoKCkgPT4gcGFyc2VDYXBzKGNhcHMsIHt9KSkuc2hvdWxkLnRocm93KC9tdXN0IGJlIGEgSlNPTiBvYmplY3QvKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3JldHVybnMgYSBtYXRjaGVkQ2FwcyBvYmplY3QgKDYpJywgZnVuY3Rpb24gKCkge1xuICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGNhcHMuYWx3YXlzTWF0Y2ggPSB7aGVsbG86ICd3b3JsZCd9O1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCd3aGljaCBpcyBzYW1lIGFzIGFsd2F5c01hdGNoIGlmIGZpcnN0TWF0Y2ggYXJyYXkgaXMgbm90IHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBwYXJzZUNhcHMoY2FwcykubWF0Y2hlZENhcHMuc2hvdWxkLmRlZXAuZXF1YWwoe2hlbGxvOiAnd29ybGQnfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ21lcmdlcyBjYXBzIHRvZ2V0aGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjYXBzLmZpcnN0TWF0Y2ggPSBbe2ZvbzogJ2Jhcid9XTtcbiAgICAgICAgcGFyc2VDYXBzKGNhcHMpLm1hdGNoZWRDYXBzLnNob3VsZC5kZWVwLmVxdWFsKHtoZWxsbzogJ3dvcmxkJywgZm9vOiAnYmFyJ30pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCd3aXRoIG1lcmdlZCBjYXBzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjYXBzLmZpcnN0TWF0Y2ggPSBbe2hlbGxvOiAnYmFyJywgZm9vOiAnZm9vJ30sIHtmb286ICdiYXInfV07XG4gICAgICAgIHBhcnNlQ2FwcyhjYXBzKS5tYXRjaGVkQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbCh7aGVsbG86ICd3b3JsZCcsIGZvbzogJ2Jhcid9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnI3Byb2Nlc3NDYXBzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIFwiYWx3YXlzTWF0Y2hcIiBpZiBcImZpcnN0TWF0Y2hcIiBhbmQgXCJjb25zdHJhaW50c1wiIHdlcmUgbm90IHByb3ZpZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgcHJvY2Vzc0NhcGFiaWxpdGllcyh7fSkuc2hvdWxkLmRlZXAuZXF1YWwoe30pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbWVyZ2VkIGNhcHMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBwcm9jZXNzQ2FwYWJpbGl0aWVzKHtcbiAgICAgICAgYWx3YXlzTWF0Y2g6IHtoZWxsbzogJ3dvcmxkJ30sXG4gICAgICAgIGZpcnN0TWF0Y2g6IFt7Zm9vOiAnYmFyJ31dXG4gICAgICB9KS5zaG91bGQuZGVlcC5lcXVhbCh7aGVsbG86ICd3b3JsZCcsIGZvbzogJ2Jhcid9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3RyaXAgb3V0IHRoZSBcImFwcGl1bTpcIiBwcmVmaXggZm9yIG5vbi1zdGFuZGFyZCBjYXBhYmlsaXRpZXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBwcm9jZXNzQ2FwYWJpbGl0aWVzKHtcbiAgICAgICAgYWx3YXlzTWF0Y2g6IHsnYXBwaXVtOmhlbGxvJzogJ3dvcmxkJ30sXG4gICAgICAgIGZpcnN0TWF0Y2g6IFt7J2FwcGl1bTpmb28nOiAnYmFyJ31dXG4gICAgICB9KS5zaG91bGQuZGVlcC5lcXVhbCh7aGVsbG86ICd3b3JsZCcsIGZvbzogJ2Jhcid9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGEgc3RhbmRhcmQgY2FwYWJpbGl0eSAoaHR0cHM6Ly93d3cudzMub3JnL1RSL3dlYmRyaXZlci8jZGZuLXRhYmxlLW9mLXN0YW5kYXJkLWNhcGFiaWxpdGllcykgaXMgcHJlZml4ZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAoKCkgPT4gcHJvY2Vzc0NhcGFiaWxpdGllcyh7XG4gICAgICAgIGFsd2F5c01hdGNoOiB7J2FwcGl1bTpwbGF0Zm9ybU5hbWUnOiAnV2hhdGV2eid9LFxuICAgICAgICBmaXJzdE1hdGNoOiBbeydhcHBpdW06YnJvd3Nlck5hbWUnOiAnQW55dGhpbmcnfV0sXG4gICAgICB9KSkuc2hvdWxkLnRocm93KC9zdGFuZGFyZCBjYXBhYmlsaXRpZXMvKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHRocm93IGFuIGV4Y2VwdGlvbiBpZiBwcmVzZW5jZSBjb25zdHJhaW50IGlzIG5vdCBtZXQgb24gYSBmaXJzdE1hdGNoIGNhcGFiaWxpdHknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBjYXBzID0gcHJvY2Vzc0NhcGFiaWxpdGllcyh7XG4gICAgICAgIGFsd2F5c01hdGNoOiB7J3BsYXRmb3JtTmFtZSc6ICdGYWtlJywgJ2FwcGl1bTpmYWtlQ2FwJzogJ2Zvb2Jhcid9LFxuICAgICAgICBmaXJzdE1hdGNoOiBbeydmb28nOiAnYmFyJ31dLFxuICAgICAgfSwge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6IHtcbiAgICAgICAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgZmFrZUNhcDoge1xuICAgICAgICAgIHByZXNlbmNlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY2Fwcy5wbGF0Zm9ybU5hbWUuc2hvdWxkLmVxdWFsKCdGYWtlJyk7XG4gICAgICBjYXBzLmZha2VDYXAuc2hvdWxkLmVxdWFsKCdmb29iYXInKTtcbiAgICAgIGNhcHMuZm9vLnNob3VsZC5lcXVhbCgnYmFyJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
