'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _desired = require('../../desired');

var _helpersSession = require('../../helpers/session');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var atv = 'android.widget.TextView';
var f = "android.widget.FrameLayout";

describe('Find - xpath', function () {
  var _this = this;

  var driver = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersSession.initDriver)(_desired.APIDEMOS_CAPS));

        case 2:
          driver = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.quit());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by type', function callee$1$0() {
    var el, text;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + atv));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text());

        case 5:
          text = context$2$0.sent;

          text.toLowerCase().should.equal('api demos');

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by text', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + atv + '[@text=\'Accessibility\']'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('Accessibility'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by attribute', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*[@enabled=\'true\' and @focused=\'true\']').should.eventually.have.length(1));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find exactly one element via elementsByXPath', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//' + atv + '[@text=\'Accessibility\']'));

        case 2:
          els = context$2$0.sent;

          els.length.should.equal(1);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(els[0].text().should.eventually.equal('Accessibility'));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by partial text', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + atv + '[contains(@text, \'Accessibility\')]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('Accessibility'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find the last element', function callee$1$0() {
    var el, text;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('(//' + atv + ')[last()]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text());

        case 5:
          text = context$2$0.sent;

          ["OS", "Text", "Views", "Preference"].should.include(text);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by index and embedded desc', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + f + '//' + atv + '[5]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('Content'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find all elements', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*'));

        case 2:
          els = context$2$0.sent;

          els.length.should.be.above(2);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find the first element when searching for all elements', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find less elements with compression turned on', function callee$1$0() {
    var elementsWithoutCompression, elementsWithCompression;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.updateSettings({ "ignoreUnimportantViews": false }));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*'));

        case 4:
          elementsWithoutCompression = context$2$0.sent;
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.updateSettings({ "ignoreUnimportantViews": true }));

        case 7:
          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*'));

        case 9:
          elementsWithCompression = context$2$0.sent;

          elementsWithoutCompression.length.should.be.greaterThan(elementsWithCompression.length);

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find toast message element by text @skip-ci', function callee$1$0() {
    var popUpEl, searchEl, addEl;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          // skip on travis, as it is too slow and the message is removed before
          // we can find it
          if (process.env.TESTOBJECT_E2E_TESTS) {
            this.skip();
          }

          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(driver.startActivity({ appPackage: 'io.appium.android.apis', appActivity: '.view.PopupMenu1' }));

        case 3:
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.waitForElementByAccessibilityId('Make a Popup!'));

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.elementByAccessibilityId('Make a Popup!'));

        case 7:
          popUpEl = context$2$0.sent;
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(popUpEl.click());

        case 10:
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(driver.waitForElementByXPath('.//*[@text=\'Search\']'));

        case 12:
          context$2$0.next = 14;
          return _regeneratorRuntime.awrap(driver.elementByXPath('.//*[@text=\'Search\']'));

        case 14:
          searchEl = context$2$0.sent;
          context$2$0.next = 17;
          return _regeneratorRuntime.awrap(searchEl.click());

        case 17:
          context$2$0.next = 19;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@text=\'Clicked popup menu item Search\']').should.eventually.exist);

        case 19:
          context$2$0.next = 21;
          return _regeneratorRuntime.awrap(popUpEl.click());

        case 21:
          context$2$0.next = 23;
          return _regeneratorRuntime.awrap(driver.waitForElementByXPath('.//*[@text=\'Add\']'));

        case 23:
          context$2$0.next = 25;
          return _regeneratorRuntime.awrap(driver.elementByXPath('.//*[@text=\'Add\']'));

        case 25:
          addEl = context$2$0.sent;
          context$2$0.next = 28;
          return _regeneratorRuntime.awrap(addEl.click());

        case 28:
          context$2$0.next = 30;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@text=\'Clicked popup menu item Add\']').should.eventually.exist);

        case 30:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9maW5kL2J5LXhwYXRoLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3VCQUNmLGVBQWU7OzhCQUNsQix1QkFBdUI7O0FBR2xELGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxHQUFHLEdBQUcseUJBQXlCLENBQUM7QUFDdEMsSUFBTSxDQUFDLEdBQUcsNEJBQTRCLENBQUM7O0FBRXZDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBWTs7O0FBQ25DLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxRQUFNLENBQUM7Ozs7OzJDQUNVLHVEQUF5Qjs7O0FBQXhDLGdCQUFNOzs7Ozs7O0dBQ1AsQ0FBQyxDQUFDO0FBQ0gsT0FBSyxDQUFDOzs7OzsyQ0FDRSxNQUFNLENBQUMsSUFBSSxFQUFFOzs7Ozs7O0dBQ3BCLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM1QixFQUFFLEVBQ0EsSUFBSTs7Ozs7MkNBREssTUFBTSxDQUFDLGNBQWMsUUFBTSxHQUFHLENBQUc7OztBQUE1QyxZQUFFOzsyQ0FDYSxFQUFFLENBQUMsSUFBSSxFQUFFOzs7QUFBdEIsY0FBSTs7QUFDVixjQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQzs7Ozs7OztHQUM5QyxDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsNkJBQTZCLEVBQUU7UUFDNUIsRUFBRTs7Ozs7MkNBQVMsTUFBTSxDQUFDLGNBQWMsUUFBTSxHQUFHLCtCQUEwQjs7O0FBQW5FLFlBQUU7OzJDQUNBLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUM7Ozs7Ozs7R0FDekQsQ0FBQyxDQUFDO0FB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TyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRTtBQUNwQyxnQkFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1dBQ2I7OzsyQ0FFSyxNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUMsVUFBVSxFQUFFLHdCQUF3QixFQUFFLFdBQVcsRUFBRSxrQkFBa0IsRUFBQyxDQUFDOzs7OzJDQUM3RixNQUFNLENBQUMsK0JBQStCLENBQUMsZUFBZSxDQUFDOzs7OzJDQUN6QyxNQUFNLENBQUMsd0JBQXdCLENBQUMsZUFBZSxDQUFDOzs7QUFBaEUsaUJBQU87OzJDQUVMLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Ozs7MkNBQ2YsTUFBTSxDQUFDLHFCQUFxQiwwQkFBd0I7Ozs7MkNBQ3JDLE1BQU0sQ0FBQyxjQUFjLDBCQUF3Qjs7O0FBQTlELGtCQUFROzsyQ0FDTixRQUFRLENBQUMsS0FBSyxFQUFFOzs7OzJDQUNoQixNQUFNLENBQUMsY0FBYyxpREFBK0MsQ0FDckUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLOzs7OzJDQUV0QixPQUFPLENBQUMsS0FBSyxFQUFFOzs7OzJDQUNmLE1BQU0sQ0FBQyxxQkFBcUIsdUJBQXFCOzs7OzJDQUNyQyxNQUFNLENBQUMsY0FBYyx1QkFBcUI7OztBQUF4RCxlQUFLOzsyQ0FDSCxLQUFLLENBQUMsS0FBSyxFQUFFOzs7OzJDQUNiLE1BQU0sQ0FBQyxjQUFjLDhDQUE0QyxDQUNsRSxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUs7Ozs7Ozs7R0FDN0IsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9maW5kL2J5LXhwYXRoLWUyZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgQVBJREVNT1NfQ0FQUyB9IGZyb20gJy4uLy4uL2Rlc2lyZWQnO1xuaW1wb3J0IHsgaW5pdERyaXZlciB9IGZyb20gJy4uLy4uL2hlbHBlcnMvc2Vzc2lvbic7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuY29uc3QgYXR2ID0gJ2FuZHJvaWQud2lkZ2V0LlRleHRWaWV3JztcbmNvbnN0IGYgPSBcImFuZHJvaWQud2lkZ2V0LkZyYW1lTGF5b3V0XCI7XG5cbmRlc2NyaWJlKCdGaW5kIC0geHBhdGgnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBkcml2ZXI7XG4gIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgZHJpdmVyID0gYXdhaXQgaW5pdERyaXZlcihBUElERU1PU19DQVBTKTtcbiAgfSk7XG4gIGFmdGVyKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkcml2ZXIucXVpdCgpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgdHlwZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5WFBhdGgoYC8vJHthdHZ9YCk7XG4gICAgY29uc3QgdGV4dCA9IGF3YWl0IGVsLnRleHQoKTtcbiAgICB0ZXh0LnRvTG93ZXJDYXNlKCkuc2hvdWxkLmVxdWFsKCdhcGkgZGVtb3MnKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBlbGVtZW50IGJ5IHRleHQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAvLyR7YXR2fVtAdGV4dD0nQWNjZXNzaWJpbGl0eSddYCk7XG4gICAgYXdhaXQgZWwudGV4dCgpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCdBY2Nlc3NpYmlsaXR5Jyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSBhdHRyaWJ1dGUnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgZHJpdmVyLmVsZW1lbnRzQnlYUGF0aChgLy8qW0BlbmFibGVkPSd0cnVlJyBhbmQgQGZvY3VzZWQ9J3RydWUnXWApXG4gICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuaGF2ZS5sZW5ndGgoMSk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgZXhhY3RseSBvbmUgZWxlbWVudCB2aWEgZWxlbWVudHNCeVhQYXRoJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZWxlbWVudHNCeVhQYXRoKGAvLyR7YXR2fVtAdGV4dD0nQWNjZXNzaWJpbGl0eSddYCk7XG4gICAgZWxzLmxlbmd0aC5zaG91bGQuZXF1YWwoMSk7XG4gICAgYXdhaXQgZWxzWzBdLnRleHQoKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnQWNjZXNzaWJpbGl0eScpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgcGFydGlhbCB0ZXh0JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLy8ke2F0dn1bY29udGFpbnMoQHRleHQsICdBY2Nlc3NpYmlsaXR5JyldYCk7XG4gICAgYXdhaXQgZWwudGV4dCgpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCdBY2Nlc3NpYmlsaXR5Jyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgdGhlIGxhc3QgZWxlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5WFBhdGgoYCgvLyR7YXR2fSlbbGFzdCgpXWApO1xuICAgIGxldCB0ZXh0ID0gYXdhaXQgZWwudGV4dCgpO1xuICAgIFtcIk9TXCIsIFwiVGV4dFwiLCBcIlZpZXdzXCIsIFwiUHJlZmVyZW5jZVwiXS5zaG91bGQuaW5jbHVkZSh0ZXh0KTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBlbGVtZW50IGJ5IGluZGV4IGFuZCBlbWJlZGRlZCBkZXNjJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLy8ke2Z9Ly8ke2F0dn1bNV1gKTtcbiAgICBhd2FpdCBlbC50ZXh0KCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0NvbnRlbnQnKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBhbGwgZWxlbWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5lbGVtZW50c0J5WFBhdGgoYC8vKmApO1xuICAgIGVscy5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDIpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIHRoZSBmaXJzdCBlbGVtZW50IHdoZW4gc2VhcmNoaW5nIGZvciBhbGwgZWxlbWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAvLypgKTtcbiAgICBlbC5zaG91bGQuZXhpc3Q7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgbGVzcyBlbGVtZW50cyB3aXRoIGNvbXByZXNzaW9uIHR1cm5lZCBvbicsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkcml2ZXIudXBkYXRlU2V0dGluZ3Moe1wiaWdub3JlVW5pbXBvcnRhbnRWaWV3c1wiOiBmYWxzZX0pO1xuICAgIGxldCBlbGVtZW50c1dpdGhvdXRDb21wcmVzc2lvbiA9IGF3YWl0IGRyaXZlci5lbGVtZW50c0J5WFBhdGgoYC8vKmApO1xuICAgIGF3YWl0IGRyaXZlci51cGRhdGVTZXR0aW5ncyh7XCJpZ25vcmVVbmltcG9ydGFudFZpZXdzXCI6IHRydWV9KTtcbiAgICBsZXQgZWxlbWVudHNXaXRoQ29tcHJlc3Npb24gPSBhd2FpdCBkcml2ZXIuZWxlbWVudHNCeVhQYXRoKGAvLypgKTtcbiAgICBlbGVtZW50c1dpdGhvdXRDb21wcmVzc2lvbi5sZW5ndGguc2hvdWxkLmJlLmdyZWF0ZXJUaGFuKGVsZW1lbnRzV2l0aENvbXByZXNzaW9uLmxlbmd0aCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgdG9hc3QgbWVzc2FnZSBlbGVtZW50IGJ5IHRleHQgQHNraXAtY2knLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgLy8gc2tpcCBvbiB0cmF2aXMsIGFzIGl0IGlzIHRvbyBzbG93IGFuZCB0aGUgbWVzc2FnZSBpcyByZW1vdmVkIGJlZm9yZVxuICAgIC8vIHdlIGNhbiBmaW5kIGl0XG4gICAgaWYgKHByb2Nlc3MuZW52LlRFU1RPQkpFQ1RfRTJFX1RFU1RTKSB7XG4gICAgICB0aGlzLnNraXAoKTtcbiAgICB9XG5cbiAgICBhd2FpdCBkcml2ZXIuc3RhcnRBY3Rpdml0eSh7YXBwUGFja2FnZTogJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCBhcHBBY3Rpdml0eTogJy52aWV3LlBvcHVwTWVudTEnfSk7XG4gICAgYXdhaXQgZHJpdmVyLndhaXRGb3JFbGVtZW50QnlBY2Nlc3NpYmlsaXR5SWQoJ01ha2UgYSBQb3B1cCEnKTtcbiAgICBsZXQgcG9wVXBFbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlBY2Nlc3NpYmlsaXR5SWQoJ01ha2UgYSBQb3B1cCEnKTtcblxuICAgIGF3YWl0IHBvcFVwRWwuY2xpY2soKTtcbiAgICBhd2FpdCBkcml2ZXIud2FpdEZvckVsZW1lbnRCeVhQYXRoKGAuLy8qW0B0ZXh0PSdTZWFyY2gnXWApO1xuICAgIGxldCBzZWFyY2hFbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLi8vKltAdGV4dD0nU2VhcmNoJ11gKTtcbiAgICBhd2FpdCBzZWFyY2hFbC5jbGljaygpO1xuICAgIGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLy8qW0B0ZXh0PSdDbGlja2VkIHBvcHVwIG1lbnUgaXRlbSBTZWFyY2gnXWApXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5leGlzdDtcblxuICAgIGF3YWl0IHBvcFVwRWwuY2xpY2soKTtcbiAgICBhd2FpdCBkcml2ZXIud2FpdEZvckVsZW1lbnRCeVhQYXRoKGAuLy8qW0B0ZXh0PSdBZGQnXWApO1xuICAgIGxldCBhZGRFbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLi8vKltAdGV4dD0nQWRkJ11gKTtcbiAgICBhd2FpdCBhZGRFbC5jbGljaygpO1xuICAgIGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLy8qW0B0ZXh0PSdDbGlja2VkIHBvcHVwIG1lbnUgaXRlbSBBZGQnXWApXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5leGlzdDtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
